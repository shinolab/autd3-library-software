<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Link - AUTD3 Developers Manual v1.9.2</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../Software/index.html"><strong aria-hidden="true">1.</strong> Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Software/about_AUTD3.html"><strong aria-hidden="true">1.1.</strong> About AUTD3</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/index.html"><strong aria-hidden="true">1.2.</strong> C++ User's Manual</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Software/Users_Manual/concept.html"><strong aria-hidden="true">1.2.1.</strong> Concept</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/getting_started.html"><strong aria-hidden="true">1.2.2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/geometry.html"><strong aria-hidden="true">1.2.3.</strong> Geometry</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/link.html" class="active"><strong aria-hidden="true">1.2.4.</strong> Link</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/gain.html"><strong aria-hidden="true">1.2.5.</strong> Gain</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/modulation.html"><strong aria-hidden="true">1.2.6.</strong> Modulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Software/Users_Manual/filter.html"><strong aria-hidden="true">1.2.6.1.</strong> Filter</a></li></ol></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/stm.html"><strong aria-hidden="true">1.2.7.</strong> Spatio-Temporal Modulation</a></li><li class="chapter-item expanded "><a href="../../Software/Users_Manual/controller.html"><strong aria-hidden="true">1.2.8.</strong> Controller</a></li></ol></li><li class="chapter-item expanded "><a href="../../Software/FFI/index.html"><strong aria-hidden="true">1.3.</strong> FFI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Software/FFI/csharp.html"><strong aria-hidden="true">1.3.1.</strong> C#</a></li><li class="chapter-item expanded "><a href="../../Software/FFI/python.html"><strong aria-hidden="true">1.3.2.</strong> python</a></li><li class="chapter-item expanded "><a href="../../Software/FFI/julia.html"><strong aria-hidden="true">1.3.3.</strong> Julia</a></li><li class="chapter-item expanded "><a href="../../Software/FFI/rust.html"><strong aria-hidden="true">1.3.4.</strong> Rust</a></li><li class="chapter-item expanded "><a href="../../Software/FFI/reference.html"><strong aria-hidden="true">1.3.5.</strong> C API Reference</a></li></ol></li><li class="chapter-item expanded "><a href="../../Software/Emulator/index.html"><strong aria-hidden="true">1.4.</strong> Emulator</a></li><li class="chapter-item expanded "><a href="../../Software/GUI/index.html"><strong aria-hidden="true">1.5.</strong> GUI</a></li></ol></li><li class="chapter-item expanded "><a href="../../Citation/index.html"><strong aria-hidden="true">2.</strong> Citation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AUTD3 Developers Manual v1.9.2</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shinolab/autd3-docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="link"><a class="header" href="#link">Link</a></h1>
<p><em>Link</em> is the interface to the AUTD3 device.
You need to choose one of the following.</p>
<h2 id="twincat"><a class="header" href="#twincat">TwinCAT</a></h2>
<p>TwinCAT is the only official way to use EherCAT on a PC.
TwinCAT is a very special software which only supports Windows and makes Windows real-time.</p>
<p>TwinCAT requires a specific network controller, please check <a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tc3_overview/9309844363.html&amp;id=">supported network controllers list</a>.</p>
<blockquote>
<p>Note: Alternatively, after installing TwinCAT, you can find the <em>Vendor ID</em> and <em>Device ID</em> of the supported network controller in <code>C:/TwinCAT/3.1/Driver/System/TcI8254x.inf</code>.</p>
</blockquote>
<h3 id="how-to-install-twincat"><a class="header" href="#how-to-install-twincat">How to install TwinCAT</a></h3>
<p>TwinCAT cannot coexist with Hyper-V and Virtual Machine Platform.
Therefore, you need to disable these features.
To do this, for example, run PowerShell with administrative privileges, and enter following commands,</p>
<pre><code>Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor
Disable-WindowsOptionalFeature -online -featurename VirtualMachinePlatform
</code></pre>
<p>First, download <em>TwinCAT XAE</em> from the <a href="https://www.beckhoff.com/en-en/">official website</a>.
Registration (free) is required to download the software.</p>
<p>Then, launch the installer and follow the instructions.
<strong>At this time, check “TwinCAT XAE Shell install” and uncheck “Visual Studio Integration”.</strong></p>
<p>After the installation, reboot and then run <code>C:/TwinCAT/3.1/System/win8settick.bat</code> with administrator privileges and reboot again.</p>
<p>Finally, copy the file <code>AUTDServer/AUTD.xml</code> in the SDK to <code>C:/TwinCAT/3.1/Config/Io/EtherCAT</code>.</p>
<h3 id="autdserver"><a class="header" href="#autdserver">AUTDServer</a></h3>
<p>To use TwinCAT Link, run <code>AUTDServer/AUTDServer.exe</code> in advance.
After executing AUTDServer, you will be prompted to enter your IP address, but please leave it empty.
Then, a TwinCAT XAE Shell will be launched.
Finally, you will be asked to close the shell.
If you use AUTDServer at the first time, please enter <code>No</code> and follow the instructions below to setup </p>
<blockquote>
<p>Note: If you close it, you can open AUTDServer shell by launching <code>%Temp%/TwinCATAUTDServer/TwinCATAUTDServer.sln</code> as TcXaeShell Application, where <code>%Temp%</code> is an environment variable, usually <code>C:/Users/(user name)/AppData/Local/Temp</code>.</p>
</blockquote>
<p>Note that AUTDServer (i.e. TwinCAT) will break the link when you turn off your PC, enter the sleep mode, etc., so you should re-run AUTDServer each time.</p>
<h4 id="install-driver"><a class="header" href="#install-driver">Install Driver</a></h4>
<p>For the first time, you need to install a driver for EtherCAT.
From the top menu of the TwinCAT XAE Shell, go to “TwinCAT” -&gt; “Show Realtime Ethernet Compatible Devices” and select a compatible device from the list of compatible devices and click on Install.
If nothing is shown in the compatible devices, the network controllers of the PC are not compatible with TwinCAT.</p>
<h4 id="licensing"><a class="header" href="#licensing">Licensing</a></h4>
<p>The first time you run the program, you will get an error related to the license, so open “Solution Explorer” -&gt; “SYSTEM” -&gt; “License” in XAE Shell, and click “7 Days Trial License ...”. and enter the text displayed on the screen.
Note that the license is a 7-day trial license, but can be reissued when it expires by performing the same procedure again.
After the license is issued, close the XAE Shell and run “AUTDServer.exe” again.</p>
<h3 id="trouble-shooting"><a class="header" href="#trouble-shooting">Trouble shooting</a></h3>
<p>If you try to use a large number of devices, you may get an error like the figure below.
In this case, multiply the values of <code>TaskCycleTime</code> and <code>Sync0Cycletime</code> in <code>settings.ini</code> by an integer, and run AUTDServer again.
Roughly speaking, <code>TaskCycleTime</code> means the interval of data update, and <code>Sync0Cycletime</code> means the interval of synchronization signal firing.
Therefore, you should choose as small values as possible.
How many times the value depends on the number of connected devices.
For example, when you have 9 devices, it should work if you multiply the number by 2.</p>
<pre><code>TaskCycleTime=20000
CPUbaseTime=10000
Sync0Cycletime=1000000
</code></pre>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/tcerror.jpg"/>
  <figcaption>TwinCAT error when using 9 devices</figcaption>
</figure>
<h2 id="remotetwincat"><a class="header" href="#remotetwincat">RemoteTwinCAT</a></h2>
<p>As mentioned above, TwinCAT requires a Windows OS and a specific network adapter.
If you want to use develop client applications on non-Windows PCs, you can use RemoteTwinCAT link to control TwinCAT remotely.
(SOEM link described below also works on cross-platform).</p>
<p>To use RemoteTwinCAT, you need to prepare two PCs.
One of the PCs must be able to use TwinCAT link described above.
Herein, we call this PC a “server”.
On the other hand, the PC on the development side, i.e., the one that uses the SDK, has no restriction, but is required to be connected to the same LAN as the server, which we call the “client”.</p>
<p>First, please connect the “server” to the AUTD device.
In this case, the LAN adapter used must be TwinCAT compatible, as in the TwinCAT link.
Also, connect the server and the client with another LAN.
This LAN adapter does not need to be TwinCAT compatible <sup class="footnote-reference"><a href="#fn_remote_twin">1</a></sup>.
Then, check the IP of the LAN between the server and the client.
For example, let’s assume that the server IP is “169.254.205.219” and the client IP is “169.254.175.45”.
Next, start AUTDServer on the “server”.
After starting, you will be asked to enter the IP, where you should enter the IP of the client side (<code>169.254.175.45</code> in this example).
Then, enter “No” at the end to leave TwinCATAUTDServer open.
As shown in the following figure, open “SYSTEM”→”Routes” and check <em>AmsNetId</em> in Current Route tab and <em>Local NetId</em> in NetId Management tab.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/Current_Route.jpg"/>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/NetId_Management.jpg"/>
  <figcaption>AmsNetId/Local NetId</figcaption>
</figure>
<p>Let’s assume that <em>AmsNetId</em> and <em>Local NetId</em> are “169.254.175.45.1.1” and “172.16.99.194.1.1”, respectively.
In this case, the client side should include the <code>autd3/link/remote_twincat.hpp</code> header, and use RemoteTwinCAT link as,</p>
<pre><code class="language-cpp">#include &quot;autd3/link/remote_twincat.hpp&quot;

...
  const std::string remote_ipv4_addr = &quot;169.254.205.219&quot;;
  const std::string remote_ams_net_id = &quot;172.16.99.194.1.1&quot;;
  const std::string local_ams_net_id = &quot;169.254.175.45.1.1&quot;;
  auto link = autd::link::RemoteTwinCAT::create(remote_ipv4_addr, remote_ams_net_id, local_ams_net_id);
</code></pre>
<p>If you get TCP-related errors, there is a possibility that the ADS protocol is blocked by firewall.
If so, configure your firewall to allow connections on port 48898 of TCP/UDP.</p>
<h2 id="soem"><a class="header" href="#soem">SOEM</a></h2>
<p><a href="https://github.com/OpenEtherCATsociety/SOEM">SOEM</a> is an open-source EherCAT Master library.
Unlike TwinCAT, SOEM runs on ordinary Windows, so its real-time performance is not guaranteed.
Therefore, it is recommended to use TwinCAT in principle.
SOEM should be used only when there is a compelling reason to use it, or only during development.
On the other hand, SOEM has the advantage of cross-platform operation and simple installation.</p>
<p>For Windows, you should install <a href="https://nmap.org/npcap/">npcap</a> or <a href="https://www.winpcap.org/">WinPcap</a> in advance.
npcap is the successor of WinPcap, and we recommend you to use it.
<strong>Note that npcap should be installed with “WinPcap API compatible mode”.</strong>
For Linux/macOS, no special preparation is required.</p>
<p>Please include <code>autd3/link/soem.hpp</code> to use SOEM link.</p>
<pre><code class="language-cpp">#include &quot;autd3/link/soem.hpp&quot;

...

  auto link = autd::link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices());
</code></pre>
<p>The first argument of <code>SOEM::create</code> is the interface name and the second argument is the number of devices.
The interface name is the name of the ethernet interface connected to the AUTD3 device.
The interface list can be retrieved by the <code>SOEM::enumerate_adapters</code> function.</p>
<pre><code class="language-cpp">  const auto adapters = autd::link::SOEM::enumerate_adapters();
  for (auto&amp;&amp; [desc, name] : adapters) std::cout &lt;&lt; desc &lt;&lt; &quot;, &quot; &lt;&lt; name &lt;&lt; std::endl;
</code></pre>
<p>Note that SOEM sometimes becomes unstable when a large number of devices are used.
In this case, increase the value of the third argument of <code>create</code> (<code>cycle_ticks</code>) (default is 1).</p>
<pre><code class="language-cpp">  const uint32_t cycle_ticks = 2;
  auto link = autd::link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices(), cycle_ticks);
</code></pre>
<p>The <code>cycle_ticks</code> controls the data update interval and the firing period of the synchronization signal.
The default values of the data update interval and the firing period of the synchronization signal are <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>, respectively, which are multiplied by the value of <code>cycle_ticks</code>.
Therefore, it is recommended to choose the smallest possible value.</p>
<p>SOEM Link can also be configured with a callback when an unrecoverable error occurs (e.g., a cable is disconnected)<sup class="footnote-reference"><a href="#fn_soem_err">2</a></sup>.
The callback takes an error message as an argument.</p>
<pre><code class="language-cpp">  link-&gt;on_lost([](const std::string&amp; msg) {
    std::cerr &lt;&lt; &quot;Link is lost\n&quot;;
    std::cerr &lt;&lt; msg;
    std::quick_exit(-1);
  });
</code></pre>
<h2 id="emulator"><a class="header" href="#emulator">Emulator</a></h2>
<p>Emulator link is a link to use <a href="https://github.com/shinolab/autd-emulator">AUTD Emulator</a> (which will be described after).</p>
<p>Before using it, you need to run the AUTD Emulator.</p>
<p>To use Emulator link, include the <code>autd3/link/emulator.hpp</code> .</p>
<pre><code class="language-cpp">#include &quot;autd3/link/emulator.hpp&quot;

...

  auto link = autd::link::Emulator::create(50632, autd-&gt;geometry());
</code></pre>
<p>The first argument of <code>Emulator::create</code> is a port number (default is 50632), and the second argument is Geometry.</p>
<div class="footnote-definition" id="fn_remote_twin"><sup class="footnote-definition-label">1</sup>
<p>Wireless LAN also can be used.</p>
</div>
<div class="footnote-definition" id="fn_soem_err"><sup class="footnote-definition-label">2</sup>
<p>Since it is not recoverable, the only thing you can do is terminate the program immediately.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Software/Users_Manual/geometry.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../Software/Users_Manual/gain.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Software/Users_Manual/geometry.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../Software/Users_Manual/gain.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
