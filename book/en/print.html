<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>AUTD3 Developers Manual v1.9.1</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Software/index.html"><strong aria-hidden="true">1.</strong> Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Software/about_AUTD3.html"><strong aria-hidden="true">1.1.</strong> About AUTD3</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/index.html"><strong aria-hidden="true">1.2.</strong> C++ User's Manual</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Software/Users_Manual/concept.html"><strong aria-hidden="true">1.2.1.</strong> Concept</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/getting_started.html"><strong aria-hidden="true">1.2.2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/geometry.html"><strong aria-hidden="true">1.2.3.</strong> Geometry</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/link.html"><strong aria-hidden="true">1.2.4.</strong> Link</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/gain.html"><strong aria-hidden="true">1.2.5.</strong> Gain</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/modulation.html"><strong aria-hidden="true">1.2.6.</strong> Modulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Software/Users_Manual/filter.html"><strong aria-hidden="true">1.2.6.1.</strong> Filter</a></li></ol></li><li class="chapter-item expanded "><a href="Software/Users_Manual/stm.html"><strong aria-hidden="true">1.2.7.</strong> Spatio-Temporal Modulation</a></li><li class="chapter-item expanded "><a href="Software/Users_Manual/controller.html"><strong aria-hidden="true">1.2.8.</strong> Controller</a></li></ol></li><li class="chapter-item expanded "><a href="Software/FFI/index.html"><strong aria-hidden="true">1.3.</strong> FFI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Software/FFI/csharp.html"><strong aria-hidden="true">1.3.1.</strong> C#</a></li><li class="chapter-item expanded "><a href="Software/FFI/python.html"><strong aria-hidden="true">1.3.2.</strong> python</a></li><li class="chapter-item expanded "><a href="Software/FFI/julia.html"><strong aria-hidden="true">1.3.3.</strong> Julia</a></li><li class="chapter-item expanded "><a href="Software/FFI/rust.html"><strong aria-hidden="true">1.3.4.</strong> Rust</a></li><li class="chapter-item expanded "><a href="Software/FFI/reference.html"><strong aria-hidden="true">1.3.5.</strong> API Reference</a></li></ol></li><li class="chapter-item expanded "><a href="Software/Emulator/index.html"><strong aria-hidden="true">1.4.</strong> Emulator</a></li><li class="chapter-item expanded "><a href="Software/GUI/index.html"><strong aria-hidden="true">1.5.</strong> GUI</a></li></ol></li><li class="chapter-item expanded "><a href="Citation/index.html"><strong aria-hidden="true">2.</strong> Citation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AUTD3 Developers Manual v1.9.1</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shinolab/autd3-docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="software"><a class="header" href="#software">Software</a></h1>
<p>This document describes how to use the <a href="https://github.com/shinolab/autd3-library-software.git">autd3 library</a> (hereinafter we called it as <em>SDK</em>).
This SDK is written in C++.
But libraries for other languages are also available, and their usage is described in <a href="Software/./FFI/index.html">FFI</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="about-autd3"><a class="header" href="#about-autd3">About AUTD3</a></h1>
<p>An ultrasound phased array is an ultrasound transducers array, typically arranged in a grid.
By individually controlling the phase and amplitude of ultrasonic waves, an arbitrary sound field can be generated in space.</p>
<p>The convergence of sound energy creates acoustic radiation pressure. 
This pressure enables the human body surface to be pushed in a non-contact manner.
The focal point is generated by the principle of “phased array,” and the focal position can be controlled electronically.
In addition to creating a single focal point, you can create a complex spatial distribution by solving the inverse problem with a computer.</p>
<p>The magnitude of the pressure generated by the phased array is currently up to about <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">N</span></span></span></span></span></span> per square centimeter.
The spatial resolution is up to the used wavelength (e.g., <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span> at <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>).
Despite these restrictions, you can freely design the spatiotemporal distribution of force within that range and create various tactile sensations.</p>
<p>This area of ​​technology that stimulates tactile sensation in a non-contact manner is called “Midair Haptics,” and we refer to this ultrasound midair haptics device as the Airborne Ultrasound Tactile Display (AUTD).
The essential parts of AUTD were proposed and established by The University of Tokyo between 2008<sup class="footnote-reference"><a href="#1">1</a></sup> and the early 2010s<sup class="footnote-reference"><a href="#2">2</a></sup>.
Since then, some universities and companies from various countries have entered, and R&amp;D has been actively conducted.</p>
<p><a href="https://hapislab.org/airborne-ultrasound-tactile-display">Please also see a list of our studies using AUTD on our laboratory’s website.</a></p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://hapislab.org/public/hiroyuki_shinoda/research/pdf/08Eurohaptics_iwamoto.pdf">Takayuki Iwamoto, Mari Tatezono, and Hiroyuki Shinoda: Non-contact Method for Producing Tactile Sensation Using Airborne Ultrasound, Haptics: Perception, Devices and Scenarios: 6th International Conference, Eurohaptics 2008 Proceedings (Lecture Notes in Computer Science), pp.504-513, 2008.</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://hapislab.org/public/hiroyuki_shinoda/research/pdf/10_Trans_Haptics_Hoshi.pdf">Takayuki Hoshi, Masafumi Takahashi, Takayuki Iwamoto, and Hiroyuki Shinoda: Noncontact Tactile Display Based on Radiation Pressure of Airborne Ultrasound, IEEE Trans. on Haptics, Vol. 3, No. 3, pp.155-165, 2010.</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="users-manual"><a class="header" href="#users-manual">User’s Manual</a></h1>
<p>In this section, the basic usage of the library is described.</p>
<p>Please also refer to the online <a href="https://shinolab.github.io/autd3-library-software/index.html">API Reference</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="concept"><a class="header" href="#concept">Concept</a></h1>
<p>The primary classes that make up the SDK are as follows,</p>
<ul>
<li><code>Controller</code> - All operations for AUTD3 are performed via this class</li>
<li><code>Geometry</code> - Manage the geometry of devices in the real world</li>
<li><code>Link</code> - Interface to the devices</li>
<li><code>Gain</code> - Class to manage the phase/amplitude of each transducer</li>
<li><code>Modulation</code> - Class to manage Amplitude Modulation (AM)</li>
<li><code>Sequence</code> - Class to manage Spatio-Temporal Modulation (STM) functions on Hardware</li>
</ul>
<p>The flow of using SDK is as follows,</p>
<ul>
<li>Create a <code>Controller</code></li>
<li>Setting the position and orientation of connected devices</li>
<li>Create <code>Link</code>, and connect to devices </li>
<li>Create and send <code>Gain</code>/<code>Sequence</code>, and/or <code>Modulation</code></li>
</ul>
<p>Here is a picture of the AUTD3 from the top.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/autd_trans_idx.jpg"/>
  <figcaption>AUTD front</figcaption>
</figure>
<p>The image of the back of AUTD3 is shown below. 
The connector for the 24V power supply is <em>Molex 5566-02A</em>.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/autd_back.jpg"/>
  <figcaption>AUTD back</figcaption>
</figure>
<p>Each unit of AUTD3 consists of 249 transduces<sup class="footnote-reference"><a href="#fn_asm">1</a></sup>, each of which is assigned an index number as shown in the above figure.
From SDK, the phase/amplitude of all these transducers can be controlled individually in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span> resolutions.</p>
<p>The coordinate system of AUTD3 is a right-handed, where the center of the 0-th transducer is the origin.
The <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>-axis is in the direction of the major axis, i.e., 0→17, and the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-axis is in the direction 0→18.
The unit system in SDK is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span> for distance, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">r</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span></span></span></span></span></span> for angle, and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span> for frequency.
The transducers are arranged at intervals of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span>, and the total size including the substrate is <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">1</span><span class="mord">9</span><span class="mord">2</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span><span class="mord">1</span><span class="mord">.</span><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span>.
The outline drawing of the transducers array is shown below.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/transducers_array.jpg"/>
  <figcaption>Design drawing of transducer array</figcaption>
</figure>
<p>In addition, multiple AUTD3 units can be connected and extended by daisy-chaining.
An extended array can be configured by connecting a PC to the first <code>EherCAT In</code> via an ethernet cable and connecting the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>-th <code>EherCAT Out</code> to the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>-th <code>EherCAT In</code>.
The ethernet cable used must be CAT 5e or higher category.</p>
<div class="footnote-definition" id="fn_asm"><sup class="footnote-definition-label">1</sup>
<p>Three transducers are missing from <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">2</span></span></span></span>. The reason why the screw holes are placed at their positions is to minimize the gaps when multiple units are placed densely.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>This section will describe how to use AUTD3 in practice.
In the following instructions, Windows 10 64bit will be used, and please modify the instructions appropriately if you use other OS.</p>
<h2 id="install"><a class="header" href="#install">Install</a></h2>
<p>First, install build tools.
The tools and versions used in this section are as follows.
Please follow the official instructions to install each of them.
For Visual Studio Community, install “Desktop Development with C++”.
If you are using Linux, you can use gcc. If you are using macOS, you can use clang.
In addition, since the following instruction will be operated from a terminal, you should set PATH appropriately.</p>
<ul>
<li>Visual Studio Community 2022 17.0.0</li>
<li>CMake 3.21.3</li>
<li>git 2.33.1.windows.1</li>
<li>npcap 1.55</li>
</ul>
<h2 id="setup-device"><a class="header" href="#setup-device">Setup Device</a></h2>
<p>Next, let’s set up the devices.
Here we will use only one AUTD3 device.
Please connect the ethernet port of the PC to the <code>EtherCAT In</code> of the AUTD3 device (see <a href="Software/Users_Manual/concept.html">Concept</a>) with an ethernet cable.
Next, connect the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span></span></span></span></span></span> power supply.</p>
<h3 id="firmware-update"><a class="header" href="#firmware-update">Firmware update</a></h3>
<p>If the firmware is old, the operation is not guaranteed.
The version of firmware in this document is assumed to be 1.9.</p>
<p>To update the firmware, you need a Windows 10 64bit PC with <a href="https://www.xilinx.com/products/design-tools/vivado.html">Vivado Design Suite</a> and <a href="https://www.segger.com/downloads/jlink/">J-Link Software</a> installed.</p>
<p>First, connect the AUTD3 device and the PC via <a href="https://www.xilinx.com/products/boards-and-kits/hw-usb-ii-g.html">XILINX Platform Cable</a> and <a href="https://www.segger.com/products/debug-probes/j-link/models/j-link-plus/">J-Link Plus</a> with <a href="https://www.segger-pocjapan.com/j-link-9-pin-cortex-m-adapter">J-Link 9-Pin Cortex-M Adapter</a>, and turn on the AUTD3.
Then, run <code>dist/firmware/autd_firmware_writer.ps1</code> in <a href="https://github.com/shinolab/autd3-library-software">SDK</a>.
The update will take a few minutes.</p>
<h2 id="building-first-program"><a class="header" href="#building-first-program">Building first program</a></h2>
<p>First, open a terminal and prepare an directory.</p>
<pre><code>  mkdir autd3_sample
  cd autd3_sample
</code></pre>
<p>Next, make <code>CMakeLists.txt</code> and <code>main.cpp</code> files.</p>
<pre><code>└─autd3_sample
        CMakeLists.txt
        main.cpp
</code></pre>
<p>Next, download the latest binary version of the SDK.
The binaries are available at <a href="https://github.com/shinolab/autd3-library-software/releases">GitHub Release</a>.
Unzip the downloaded binary, and copy the <code>include</code> and <code>lib</code> folders to the <code>autd3_sample</code> folder.</p>
<pre><code>└─autd3_sample
    │  CMakeLists.txt
    │  main.cpp
    ├─include
    └─lib
</code></pre>
<p>Next, download Eigen3, which is a header-only library for matrix computation.
Here, we change the current directory to <code>autd3_sample</code> and add Eigen3 as git submodule.</p>
<pre><code>  git init
  git submodule add https://gitlab.com/libeigen/eigen.git eigen
  cd eigen
  git checkout 3.4.0
  cd ..
</code></pre>
<p>Alternatively, you can directly download <a href="https://gitlab.com/libeigen/eigen">Eigen3</a> and put it under the <code>autd3_sample</code> folder. The Eigen3 version used in the SDK is 3.4.0.</p>
<p>At this time, the directory structure is as follows.</p>
<pre><code>└─autd3_sample
    │  CMakeLists.txt
    │  main.cpp
    ├─include
    ├─lib
    └─eigen
        ├─bench
        ├─blas
        ├─ci
        ├─cmake
        ...
</code></pre>
<p>Next, write <code>CMakeLists.txt</code> as follows.</p>
<pre><code>cmake_minimum_required(VERSION 3.16)

project(autd3_sample)
set (CMAKE_CXX_STANDARD 17)

add_executable(main main.cpp)

target_compile_definitions(main PRIVATE _USE_MATH_DEFINES)
target_link_directories(main PRIVATE lib)
target_include_directories(main PRIVATE include eigen)

if(WIN32)
  target_link_directories(main PRIVATE lib/wpcap)
  target_link_libraries(main autd3 soem_link Packet.lib wpcap.lib ws2_32.lib winmm.lib)
elseif(APPLE)
  target_link_libraries(main pcap)
else()
  target_link_libraries(main rt)
endif()

if(WIN32)
    set_property(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT main)
endif()
</code></pre>
<p>And, write <code>main.cpp</code> as follows.
This source code will apply <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span> AM modulation to a single focus at <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span> above of center of the array.</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;

#include &quot;autd3.hpp&quot;
#include &quot;autd3/link/soem.hpp&quot;

using namespace std;
using namespace autd;

string get_adapter_name() {
  size_t i = 0;
  const auto adapters = link::SOEM::enumerate_adapters();
  for (auto&amp;&amp; [desc, name] : adapters) cout &lt;&lt; &quot;[&quot; &lt;&lt; i++ &lt;&lt; &quot;]: &quot; &lt;&lt; desc &lt;&lt; &quot;, &quot; &lt;&lt; name &lt;&lt; endl;

  cout &lt;&lt; &quot;Choose number: &quot;;
  string in;
  getline(cin, in);
  stringstream s(in);
  if (const auto empty = in == &quot;\n&quot;; !(s &gt;&gt; i) || i &gt;= adapters.size() || empty) return &quot;&quot;;

  return adapters[i].name;
}

int main() try {
  auto autd = Controller::create();

  autd-&gt;geometry()-&gt;add_device(Vector3(0, 0, 0), Vector3(0, 0, 0));

  const auto ifname = get_adapter_name();
  auto link = link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices());
  autd-&gt;open(std::move(link));

  autd-&gt;clear();

  auto firm_info_list = autd-&gt;firmware_info_list();
  for (auto&amp;&amp; firm_info : firm_info_list) cout &lt;&lt; firm_info &lt;&lt; endl;

  autd-&gt;silent_mode() = true;

  const auto focus = Vector3(TRANS_SPACING_MM * ((NUM_TRANS_X - 1) / 2.0), TRANS_SPACING_MM * ((NUM_TRANS_Y - 1) / 2.0), 150.0);
  const auto g = gain::FocalPoint::create(focus);
  const auto m = modulation::Sine::create(150);
  autd-&gt;send(g, m);

  cout &lt;&lt; &quot;press enter to finish...&quot; &lt;&lt; endl;
  cin.ignore();

  autd-&gt;close();

  return 0;
} catch (exception&amp; ex) {
  cerr &lt;&lt; ex.what() &lt;&lt; endl;
}
</code></pre>
<p>Then, build with CMake.</p>
<pre><code>  mkdir build
  cd build
  cmake .. -G &quot;Visual Studio 17 2022&quot; -A x64
</code></pre>
<p><code>autd3_sample.sln</code> should be generated under the <em>build</em> directory, so open it and run the <em>main</em> project.
<strong>Note that you should change the build configuration of Visual Studio from Debug to Release</strong>.
In case of Linux/macOS, you may need to run the program as root user.</p>
<h2 id="explanation"><a class="header" href="#explanation">Explanation</a></h2>
<p>Here, we will explain the above codes.</p>
<p>To use the SDK, include the <code>autd3.hpp</code> header.
You also need <code>autd3/link/soem.hpp</code> to use <code>link::SOEM</code>.</p>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;
#include &quot;autd3/link/soem.hpp&quot;
</code></pre>
<p>Then, create <code>Controller</code> instance.</p>
<pre><code class="language-cpp">  auto autd = autd::Controller::create();
</code></pre>
<p>After that, we specify the geometry of the device in the real world.</p>
<pre><code class="language-cpp">  autd-&gt;geometry()-&gt;add_device(autd::Vector3(0, 0, 0), autd::Vector3(0, 0, 0));
</code></pre>
<p>The first argument of <code>add_device</code> is the position, the second argument is the rotation.
The position is 0-th transducer position in the global coordinate system you set.
The rotation is specified by ZYZ euler angles or quaternions.
Here, we assume that the device is placed at global origin without rotation.</p>
<p>Next, create <code>Link</code>, and connect to the device.</p>
<pre><code class="language-cpp">  const auto ifname = get_adapter_name();
  auto link = link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices());
  autd-&gt;open(std::move(link));
</code></pre>
<p>The first argument of <code>link::SOEM::create()</code> is the ethernet interface name where the AUTD3 device is connected, and the second argument is the number of AUTD3 devices connected. 
We prepared a utility function <code>get_adapter_name</code> to get the interface name list, so please select the appropriate one at runtime.
(On macOS or Linux, you can also use <code>ifconfig</code> to check it.)</p>
<p>Then, initialize the AUTD devices.
You may not need to call <code>clear()</code> since it is initialized at power-on.</p>
<pre><code class="language-cpp">  autd-&gt;clear();
</code></pre>
<p>Next, we check the version of the firmware.
This operation is not required to run AUTD3.</p>
<pre><code class="language-cpp">  auto firm_info_list = autd-&gt;firmware_info_list();
  for (auto&amp;&amp; firm_info : firm_info_list) cout &lt;&lt; firm_info &lt;&lt; endl;
</code></pre>
<p>Next, we set <em>silent mode</em> on.</p>
<pre><code class="language-cpp">  autd-&gt;silent_mode() = true;
</code></pre>
<p>Since it is on by default, you don’t need to call it in fact.
If you want to turn it off, please give <code>false</code>.
In <em>silent mode</em>, the phase/amplitude parameters given to the transducer are passed through a low-pass filter to reduce noise.</p>
<p>After that, send the <code>Modulation</code> which applies <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span> Sin wave amplitude modulation and the <code>Gain</code> which represents the single focus.</p>
<pre><code class="language-cpp">  const auto point = autd::Vector3(autd::TRANS_SPACING_MM * ((autd::NUM_TRANS_X - 1) / 2.0), autd::TRANS_SPACING_MM * ((autd::NUM_TRANS_Y - 1) / 2.0), 150.0);
  const auto g = autd::gain::FocalPoint::create(point);
  const auto m = autd::modulation::Sine::create(150);
  autd-&gt;send(g, m);
</code></pre>
<p>The <code>point</code> is a bit complicated; <code>TRANS_SPACING_MM</code> represents the spacing of the transducers, and <code>NUM_TRANS_X</code> and <code>NUM_TRANS_Y</code> represent the number of transducers in the <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>-axis, respectively.
Therefore, <code>point</code> represents the point <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span> right above the center of the transducers array.</p>
<p>Finally, you should disconnect the device.</p>
<pre><code class="language-cpp">  autd-&gt;close();
</code></pre>
<p>In the next section, we will describe the basic functions.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="geometry"><a class="header" href="#geometry">Geometry</a></h1>
<p>この章ではGeometryについて解説する.
GeometryはAUTD3デバイスが現実世界でどのように配置されているかを管理している.</p>
<p>なお, AUTD3デバイスには249個の振動子が配置されており, 以下の図のようにindexが割り振られている.</p>
<h2 id="multiple-devices"><a class="header" href="#multiple-devices">Multiple devices</a></h2>
<p>AUTD3のデバイスは複数台をデイジーチェーンで接続できるようになっている.
SDKは複数台を接続したとしても, 透過的に使用できるように設計されている.</p>
<p>復数のデバイスを接続する場合は,
PCと1台目のEtherCAT Inをケーブルでつなぎ, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span>台目のEtherCAT Outと<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>台目のEtherCAT Inをケーブルで接続する (<a href="Software/Users_Manual/concept.html">Concept</a>参照).
なお, 電源もデイジーチェーンで接続でき, 電源コネクタは3つの内で好きなところを使って良い.</p>
<p>SDKで複数台のデバイスを使用する場合は<code>add_device</code>関数を接続しているデバイスの分だけ呼び出せば良い.
<code>add_device</code>関数の第1引数は位置であり, 第2引数は回転を表す.
回転はZYZのオイラー角, または, Quaternionで指定する.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/autd_hori.jpg"/>
  <figcaption>Horizontal alignment</figcaption>
</figure>
<p>例えば, 上図のように配置・接続しており, 図左側のデバイスが1台目, 右側のデバイスが2台目だとする.
さらに, グローバル座標を1台目のローカル座標と同じだとすると,</p>
<pre><code class="language-cpp">  autd-&gt;geometry()-&gt;add_device(autd::Vector3(0, 0, 0), autd::Vector3(0, 0, 0));
  autd-&gt;geometry()-&gt;add_device(autd::Vector3(autd::DEVICE_WIDTH, 0, 0), autd::Vector3(0, 0, 0));
</code></pre>
<p>とすれば良い.
ここで, <code>autd::DEVICE_WIDTH</code>はデバイスの (基板外形を含めた) 横幅である.
回転はしないので, 第2引数は<code>(0, 0, 0)</code>で良い.</p>
<p>また, 例えば, グローバル座標を2台目のローカル座標と同じだとすると,</p>
<pre><code class="language-cpp">  autd-&gt;geometry()-&gt;add_device(autd::Vector3(-autd::DEVICE_WIDTH, 0, 0), autd::Vector3(0, 0, 0));
  autd-&gt;geometry()-&gt;add_device(autd::Vector3(0, 0, 0), autd::Vector3(0, 0, 0));
</code></pre>
<p>とすれば良い.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/autd_vert.jpg"/>
  <figcaption>Vertical alignment</figcaption>
</figure>
<p>さらに, 例えば, 上図のように配置されており, 下が1台目, 左が2台目で, グローバル座標を1台目のローカル座標と同じだとすると,</p>
<pre><code class="language-cpp">  autd-&gt;geometry()-&gt;add_device(autd::Vector3(0, 0, 0), autd::Vector3(0, 0, 0));
  autd-&gt;geometry()-&gt;add_device(autd::Vector3(0, 0, autd::DEVICE_WIDTH), autd::Vector3(0, M_PI / 2.0, 0));
</code></pre>
<p>のように指定する.</p>
<p>SDKにおけるAPIでは, すべてグローバル座標を用いるため, 接続するデバイスの数に依存せず透過的に使用できる.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="link"><a class="header" href="#link">Link</a></h1>
<p>LinkはDeviceとのインターフェースである.
以下の中から一つを選択する必要がある.</p>
<h2 id="twincat"><a class="header" href="#twincat">TwinCAT</a></h2>
<p>TwinCATはPCでEherCATを使用する際の唯一の公式の方法である.
TwinCATはWindowsのみをサポートする非常に特殊なソフトウェアであり, Windowsを半ば強引にリアルタイム化する.</p>
<p>また, 特定のネットワークコントローラが必要になるため,
<a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tc3_overview/9309844363.html&amp;id=">対応するネットワークコントローラの一覧</a>を確認すること.</p>
<blockquote>
<p>Note: 或いは, TwinCATのインストール後に, <code>C:/TwinCAT/3.1/Driver/System/TcI8254x.inf</code>に対応するデバイスのVendor IDとDevice IDが書かれているので, デバイスマネージャー→イーサネットアダプタ→プロパティ→詳細→ハードウェアIDと照らし合わせることでも確認できる.</p>
</blockquote>
<h3 id="how-to-install-twincat"><a class="header" href="#how-to-install-twincat">How to install TwinCAT</a></h3>
<p>前提として, TwinCATはHyper-VやVirtual Machine Platformと共存できない.
そのため, これらのfeatureを無効にする必要がある.
これには, 例えば, PowerShellを管理者権限で起動し,</p>
<pre><code>Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor
Disable-WindowsOptionalFeature -online -featurename VirtualMachinePlatform
</code></pre>
<p>と打ち込めば良い.</p>
<p>まず, TwinCAT XAEを<a href="https://www.beckhoff.com/en-en/">公式サイト</a>からダウンロードする.
ダウンロードには登録 (無料) が必要になる.</p>
<p>ダウンロードしたインストーラを起動し, 指示に従う.
<strong>この時, TwinCAT XAE Shell installにチェックを入れ, Visual Studio Integrationのチェックを外すこと.</strong></p>
<p>インストール後に再起動し, <code>C:/TwinCAT/3.1/System/win8settick.bat</code>を管理者権限で実行し, 再び再起動する.</p>
<p>最後に, SDK内の<code>AUTDServer/AUTD.xml</code>を<code>C:/TwinCAT/3.1/Config/Io/EtherCAT</code>にコピーする.</p>
<h3 id="autdserver"><a class="header" href="#autdserver">AUTDServer</a></h3>
<p>TwinCATのLinkを使うには, まず, <code>AUTDServer/AUTDServer.exe</code>を実行する.
AUTDServer実行後に, IPアドレスの入力を求められるがここは空欄のままEnterすればよい.
すると, Visual StudioライクなTwinCAT XAE Shellが起動する.
最後に, Shellを閉じるか聞かれるが, 以下の設定がまだなら<code>No</code>を入力し, 設定を続ける.
以下の設定が済んでいるなら, 閉じてしまってかまわない.</p>
<blockquote>
<p>Note: もし閉じてしまった場合は, <code>%Temp%/TwinCATAUTDServer/TwinCATAUTDServer.sln</code>をTcXaeShell Applicationとして開けば良い. <code>%Temp%</code>は環境変数で, 普通は<code>C:/Users/(user name)/AppData/Local/Temp</code>である.</p>
</blockquote>
<p>なお, AUTDServer (というはTwinCAT) はPCの電源を切る, スリープモードに入る等でLinkが途切れるので, その都度実行し直すこと.</p>
<h4 id="install-driver"><a class="header" href="#install-driver">Install Driver</a></h4>
<p>初回はEherCAT用のドライバのインストールが必要になる.
TwinCAT XAE Shell上部メニューからTwinCAT→Show Realtime Ethernet Compatible Devicesを開きCompatible devicesの中の対応デバイスを選択肢Installをクリックする.
なお, Compatible devicesに何も表示されていない場合はそのPCのイーサネットデバイスはTwinCATに対応していない.</p>
<h4 id="license"><a class="header" href="#license">License</a></h4>
<p>また, 初回はライセンス関係のエラーが出るので, XAE ShellでSolution Explorer→SYSTEM→Licenseを開き, “7 Days Trial License ...”をクリックし, 画面に表示される文字を入力する.
なお. ライセンスは7日間限定のトライアルライセンスだが, 切れたら再び同じ作業を行うことで再発行できる.
ライセンスを発行し終わったら, XAE Shellを閉じて, 再び”AUTDServer.exe”を実行する.</p>
<h3 id="trouble-shooting"><a class="header" href="#trouble-shooting">Trouble shooting</a></h3>
<p>大量のDeviceを使用しようとすると, 下の図のようなエラーが発生することがある.
このときは, <code>settings.ini</code>内の<code>TaskCycleTime</code>と<code>Sync0Cycletime</code>の値を整数倍し, AUTDServerを再び実行する.
大雑把に言えば, <code>TaskCycleTime</code>がデータ更新間隔を, <code>Sync0Cycletime</code>が同期信号の発火間隔を意味する.
そのため, 可能な限り小さな値を選ぶべきである.
何倍にすべきは, 接続している台数に依存する.
例えば, 9台の場合は2倍しておけば動作するはずである.</p>
<pre><code>TaskCycleTime=20000
CPUbaseTime=10000
Sync0Cycletime=1000000
</code></pre>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/tcerror.jpg"/>
  <figcaption>TwinCAT error when using 9 devices</figcaption>
</figure>
<h2 id="remotetwincat"><a class="header" href="#remotetwincat">RemoteTwinCAT</a></h2>
<p>前述の通り, AUTD3とTwinCATを使う場合はWindows OSと特定のネットワークアダプタが必要になる.
しかし, Windows以外のPCで開発したい需要も多い (後述のSOEMもマルチプラットフォームで動作する).
その場合は, RemoteTwinCAT linkを用いて遠隔からTwinCATを操作することができる.</p>
<p>RemoteTwinCATを使用する場合はPCを2台用意する必要がある.
この時, 片方のPCは上記のTwinCAT linkが使えるである必要がある.
このPCをここでは”サーバ”と呼ぶ.
一方, 開発側のPC, 即ちSDKを使用する側は特に制約はなく, サーバと同じLANに繋がっていれば良い, こちらをここでは”クライアント”と呼ぶ.</p>
<p>まず, サーバとAUTDデバイスを接続する.
この時使うLANのアダプタはTwinCAT linkと同じく, TwinCAT対応のアダプタである必要がある.
また, サーバとクライアントを別のLANで繋ぐ.
こちらのLANアダプタはTwinCAT対応である必要はない<sup class="footnote-reference"><a href="#fn_remote_twin">1</a></sup>.
そして, サーバとクライアント間のLANのIPを確認しておく.
ここでは例えば, サーバ側が”169.254.205.219”, クライアント側が”169.254.175.45”だったとする.
次に, サーバでAUTDServerを起動する.
起動後にIPの入力を求められるが, ここでクライアント側のIP (この例だと<code>169.254.175.45</code>) を入力する.
また, 最後に”No”を入力し, TwinCATAUTDServerを開いたままにしておく.
以下の図のように, System→Routesを開き, Current RouteタブのAmsNetId及び, NetId ManagementタブのLocal NetIdを確認する.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/Current_Route.jpg"/>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/NetId_Management.jpg"/>
  <figcaption>AmsNetId/Local NetId</figcaption>
</figure>
<p>ここでは, それぞれ”169.254.175.45.1.1”, “172.16.99.194.1.1”だったとする.
この時, クライアント側は<code>autd3/link/remote_twincat.hpp</code>ヘッダーをincludeして,</p>
<pre><code class="language-cpp">#include &quot;autd3/link/remote_twincat.hpp&quot;

...
  const std::string remote_ipv4_addr = &quot;169.254.205.219&quot;;
  const std::string remote_ams_net_id = &quot;172.16.99.194.1.1&quot;;
  const std::string local_ams_net_id = &quot;169.254.175.45.1.1&quot;;
  auto link = autd::link::RemoteTwinCAT::create(remote_ipv4_addr, remote_ams_net_id, local_ams_net_id);
</code></pre>
<p>のようにすれば良い.</p>
<p>なお, TCP関係のエラーが出る場合は, ファイアウォールでADSプロトコルがブロックされている可能性がある.
その場合は, ファイアウォールの設定でTCP/UDPの48898番ポートの接続を許可する.</p>
<h2 id="soem"><a class="header" href="#soem">SOEM</a></h2>
<p><a href="https://github.com/OpenEtherCATsociety/SOEM">SOEM</a>は有志が開発しているOpen-sourceなEherCAT Masterライブラリである.
あくまで, 有志開発であり動作は保証されず, TwinCATとは異なり通常のWindows上で動作するためリアルタイム性も保証されない.
そのため, 基本的にTwinCATを使用することを推奨する.
SOEMを使用するのはやむを得ない理由があるか, 開発時のみに限定するべきである.
一方, SOEMはクロスプラットフォームで動作し, インストールも単純という利点がある.</p>
<p>Windowsの場合は, <a href="https://nmap.org/npcap/">npcap</a>, または, <a href="https://www.winpcap.org/">WinPcap</a>を予めインストールしておくこと.
npcapはWinPcapの後継であり, こちらの利用を推奨する.
<strong>なお, npcapをインストールする場合は”WinPcap API compatible mode”でインストールすること.</strong>
Linux/macの場合は, 特に準備は必要ない.</p>
<p>SOEMのLinkを使用する際は<code>autd3/link/soem.hpp</code>ヘッダーをインクルードする.</p>
<pre><code class="language-cpp">#include &quot;autd3/link/soem.hpp&quot;

...

  auto link = autd::link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices());
</code></pre>
<p><code>SOEM::create</code>の第1引数はインターフェース名で, 第2引数はデバイスの数である.
インターフェース名はAUTD3デバイスに接続しているehernetインターフェース名である.
これの一覧は, <code>SOEM::enumerate_adapters</code>関数によって取得できる.</p>
<pre><code class="language-cpp">  const auto adapters = autd::link::SOEM::enumerate_adapters();
  for (auto&amp;&amp; [desc, name] : adapters) std::cout &lt;&lt; desc &lt;&lt; &quot;, &quot; &lt;&lt; name &lt;&lt; std::endl;
</code></pre>
<p>なお, SOEMも大量のDeviceを使用すると挙動が不安定になる時がある<sup class="footnote-reference"><a href="#fn_soem">2</a></sup>.
このときは, <code>create</code>の第3引数 (<code>cycle_ticks</code>) の値を増やす (defaultは1).</p>
<pre><code class="language-cpp">  const uint32_t cycle_ticks = 2;
  auto link = autd::link::SOEM::create(ifname, autd-&gt;geometry()-&gt;num_devices(), cycle_ticks);
</code></pre>
<p><code>cycle_ticks</code>は, データ更新間隔と同期信号の発火周期を制御している.
データ更新間隔と同期信号の発火周期のデフォルトはそれぞれ<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>と<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>であり, これに<code>cycle_ticks</code>の値が掛け合わされる.
そのため, 可能な限り小さな値を選ぶことを推奨する.</p>
<p>また, SOEM Linkは回復不能なエラー (例えば, ケーブルが抜けるなど) が発生したときのコールバックを設定することができる<sup class="footnote-reference"><a href="#fn_soem_err">3</a></sup>.
callbackはエラーメッセージを引数に取る.</p>
<pre><code class="language-cpp">  link-&gt;on_lost([](const std::string&amp; msg) {
    std::cerr &lt;&lt; &quot;Link is lost\n&quot;;
    std::cerr &lt;&lt; msg;
    std::quick_exit(-1);
  });
</code></pre>
<h2 id="emulator"><a class="header" href="#emulator">Emulator</a></h2>
<p>Emulator linkは<a href="https://github.com/shinolab/autd-emulator">AUTD Emulator</a> (後述) を使用する際に使うLinkである.</p>
<p>使用の前に, AUTD Emulatorを実行しておく必要がある.</p>
<p>EmulatorのLinkを使用する際は<code>autd3/link/emulator.hpp</code>ヘッダーをインクルードする.</p>
<pre><code class="language-cpp">#include &quot;autd3/link/emulator.hpp&quot;

...

  auto link = autd::link::Emulator::create(50632, autd-&gt;geometry());
</code></pre>
<p><code>Emulator::create</code>の第1引数はポート番号 (デフォルトは50632) であり, 第2引数はGeometryである.</p>
<div class="footnote-definition" id="fn_remote_twin"><sup class="footnote-definition-label">1</sup>
<p>無線LANでも可</p>
</div>
<div class="footnote-definition" id="fn_soem"><sup class="footnote-definition-label">2</sup>
<p>TwinCATよりは緩く, 普通に動くこともある.</p>
</div>
<div class="footnote-definition" id="fn_soem_err"><sup class="footnote-definition-label">3</sup>
<p>なお, 回復不能なので直ちに終了するくらいしかできることはない.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="gain"><a class="header" href="#gain">Gain</a></h1>
<p>AUTDは各振動子の位相/振幅を個別に制御することができ, これによって様々な音場を生成できる.
<code>Gain</code>はこれを管理するクラスであり, SDKにはデフォルトでいくつかの種類の音場を生成するための<code>Gain</code>がデフォルトでいくつか用意されている.</p>
<h2 id="focalpoint"><a class="header" href="#focalpoint">FocalPoint</a></h2>
<p><code>FocalPoint</code>は最も単純な<code>Gain</code>であり, 単一焦点を生成する.</p>
<pre><code class="language-cpp">    const auto g = autd::gain::FocalPoint::create(autd::Vector3(x, y, z));
</code></pre>
<p><code>FocalPoint::create</code>の第1引数には焦点の位置を指定する.
第2引数として, 振幅をDuty比 (<code>uint8_t</code>), または, 0-1の規格化された音圧振幅 (<code>double</code>) で指定できる.</p>
<p>ここでDuty比<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>と音圧<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span>の関係性について注意する.
理論的には
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∝</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></span>
の関係性がある.
そのため, 音圧はDuty比<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>で最小値<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, Duty比<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">%</span></span></span></span>で最大値を取るが, その間の関係式は線形ではない.
音圧振幅で指定する場合, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>を最大値として, 内部で上記の式の逆変換を行いDuty比に変換される.</p>
<h2 id="besselbeam"><a class="header" href="#besselbeam">BesselBeam</a></h2>
<p><code>BesselBeam</code>ではその名の通りBessel beamを生成する.
この<code>Gain</code>は長谷川らの論文[hasegawa2017]に基づく.</p>
<pre><code class="language-cpp">  const autd::Vector3 apex(x, y, z);
  const autd::Vector3 dir = autd::Vector3::UnitZ();
  const double theta_z = 0.3;
  const auto g = autd::gain::BesselBeam::create(apex, dir, theta_z);
</code></pre>
<p>第1引数はビームを生成する仮想円錐の頂点であり, 第2引数はビームの方向, 第3引数はビームに垂直な面とビームを生成する仮想円錐の側面となす角度である (下図の<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>).
第4引数として, 振幅をDuty比 (<code>uint8_t</code>), または, 0-1の規格化された音圧振幅 (<code>double</code>) で指定できる.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/1.4985159.figures.online.f1.jpg"/>
  <figcaption>Bessel beam ([hasegawa2017]より引用)</figcaption>
</figure>
<h2 id="planewave"><a class="header" href="#planewave">PlaneWave</a></h2>
<p><code>PlaneWave</code>は平面波を生成する.</p>
<pre><code class="language-cpp">    const auto g = autd::gain::PlaneWave::create(autd::Vector3(x, y, z));
</code></pre>
<p><code>PlaneWave::create</code>の第1引数には平面波の方向を指定する.
第2引数として, 振幅をDuty比 (<code>uint8_t</code>), または, 0-1の規格化された音圧振幅 (<code>double</code>) で指定できる.</p>
<h2 id="transducertest"><a class="header" href="#transducertest">TransducerTest</a></h2>
<p><code>TransducerTest</code>はデバッグ用の<code>Gain</code>であり, ある一つの振動子のみを駆動する.</p>
<pre><code class="language-cpp">    const auto g = autd::gain::TransducerTest::create(index, duty, phase);
</code></pre>
<p><code>TransducerTest::create</code>の第1引数には振動子のindex, 第2引数はDuty比, 第3引数には位相を指定する.</p>
<h2 id="null"><a class="header" href="#null">Null</a></h2>
<p><code>Null</code>は振幅0の<code>Gain</code>である.</p>
<pre><code class="language-cpp">    const auto g = autd::gain::Null::create();
</code></pre>
<h2 id="holo-multiple-foci"><a class="header" href="#holo-multiple-foci">Holo (Multiple foci)</a></h2>
<p><code>Holo</code>は多焦点を生成するための<code>Gain</code>である.
多焦点を生成するアルゴリズムが幾つか提案されており, SDKには以下のアルゴリズムが実装されていてる.</p>
<ul>
<li><code>SDP</code> - Semidefinite programming, 井上らの論文[inoue2015]に基づく</li>
<li><code>EVD</code> - Eigen value decomposition, Longらの論文[long2014]に基づく</li>
<li><code>Naive</code> - 単一焦点解の重ね合わせ</li>
<li><code>GS</code> - Gershberg-Saxon, Marzoらの論文[marzo2019]に基づく</li>
<li><code>GSPAT</code> - Gershberg-Saxon for Phased Arrays of Transducers, Plasenciaらの論文[plasencia2020]に基づく</li>
<li><code>LM</code> - Levenberg-Marquardt, LM法は[levenberg1944,marquardt1963]で提案された非線形最小二乗問題の最適化法, 実装は[madsen2004]に基づく.</li>
<li><code>GaussNewton</code> - Gauss-Newton法</li>
<li><code>GradientDescent</code> - Gradient descent法</li>
<li><code>APO</code> - Acoustic Power Optimization, 長谷川らの論文[hasegawa2020]に基づく</li>
<li><code>Greedy</code> - Greedy algorithm and Brute-force search, 鈴木らの論文[suzuki2021]に基づく</li>
</ul>
<p>また, 各手法は計算Backendを選べるようになっている.
SDKには以下の<code>Backend</code>が用意されている</p>
<ul>
<li><code>EigenBackend</code> - <a href="https://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a>を使用, デフォルトで利用可能</li>
<li><code>BLASBackend</code> - <a href="https://www.openblas.net/">OpenBLAS</a>や<a href="https://software.intel.com/content/www/us/en/develop/tools/oneapi/components/onemkl.html">Intel MKL</a>等のBLAS/LAPACKを使用</li>
<li><code>CUDABackend</code> - CUDAを使用, GPUで実行</li>
<li><code>ArrayFireBackend</code> - <a href="https://arrayfire.com/">ArrayFire</a>を使用</li>
</ul>
<p><code>Holo</code>を使用するには<code>autd3/gain/eigen_backend.hpp</code>と各<code>Backend</code>のヘッダーを<code>include</code>する.</p>
<pre><code class="language-cpp">#include &quot;autd3/gain/eigen_backend.hpp&quot;
#include &quot;autd3/gain/holo.hpp&quot;

...

  const auto backend = autd::gain::holo::EigenBackend::create();
  const auto g = autd::gain::holo::SDP::create(backend, foci, amps);
</code></pre>
<p>各アルゴリズムの第1引数は<code>backend</code>, 第2引数は各焦点の位置を<code>autd::Vector3</code>の<code>vector</code>で, 第3引数は各焦点の音圧を<code>double</code>の<code>vector</code>で指定する.
また, 各アルゴリズムごとに追加のパラメータが存在する.
各パラメータの詳細はそれぞれの論文を参照されたい.</p>
<p>また, Eigen以外の<code>Backend</code>を使用するには, それぞれの<code>Backend</code>ライブラリをコンパイルする必要がある<sup class="footnote-reference"><a href="#fn_backend">1</a></sup>.</p>
<h3 id="blas-backend"><a class="header" href="#blas-backend">BLAS Backend</a></h3>
<p>BLASバックエンドをビルドするには, CMakeの<code>BUILD_BLAS_BACKEND</code>フラグをOnにして, <code>BLAS_LIB_DIR</code>でBLASライブラリのディレクトリを, <code>BLAS_INCLUDE_DIR</code>でBLASの<code>include</code>ディレクトリを指定し, <code>BLA_VENDO</code>でBLASのベンダを指定する,</p>
<pre><code class="language-cpp">cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_BLAS_BACKEND=ON -DBLAS_LIB_DIR=&lt;your BLAS library path&gt; -DBLAS_INCLUDE_DIR=&lt;your BLAS include path&gt; -DBLA_VENDOR=&lt;your BLAS vendor&gt;
</code></pre>
<p>なお, Intel MKLを使用する場合は更に, <code>USE_MKL</code>フラグをOnにする.</p>
<pre><code class="language-cpp">cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_BLAS_BACKEND=ON -DBLAS_LIB_DIR=&lt;your BLAS library path&gt; -DBLAS_INCLUDE_DIR=&lt;your BLAS include path&gt; -DBLA_VENDOR=Intel10_64lp -DUSE_MKL=ON
</code></pre>
<h4 id="openblas-install-example-for-windows"><a class="header" href="#openblas-install-example-for-windows">OpenBLAS install example for Windows</a></h4>
<p>ここではWindows向けに, BLAS実装の一つである<a href="https://github.com/xianyi/OpenBLAS">OpenBLAS</a>のインストール例を載せておく.
<a href="https://github.com/xianyi/OpenBLAS/wiki/How-to-use-OpenBLAS-in-Microsoft-Visual-Studio">Officialの説明</a>もあるのでこちらも参考にすること.</p>
<p>まず, Visual Studio 2019とAnaconda (または, miniconda)をインストールし, Anaconda Promptを開く.
Anaconda Prompt上で以下のコマンドを順に打っていく.
なお, ここでは<code>D:/lib/openblas</code>にOpenBLASをインストールすることにしている.
これは, 各自好きな場所に設定されたい.</p>
<pre><code class="language-cpp">git clone https://github.com/xianyi/OpenBLAS
cd OpenBLAS
conda update -n base conda
conda config --add channels conda-forge
conda install -y cmake flang clangdev perl libflang ninja
&quot;c:/Program Files (x86)/Microsoft Visual Studio/2019/Community/VC/Auxiliary/Build/vcvars64.bat&quot;
set &quot;LIB=%CONDA_PREFIX%\Library\lib;%LIB%&quot;
set &quot;CPATH=%CONDA_PREFIX%\Library\include;%CPATH%&quot;
mkdir build
cd build
cmake .. -G &quot;Ninja&quot; -DCMAKE_CXX_COMPILER=clang-cl -DCMAKE_C_COMPILER=clang-cl -DCMAKE_Fortran_COMPILER=flang -DCMAKE_MT=mt -DBUILD_WITHOUT_LAPACK=no -DNOFORTRAN=0 -DDYNAMIC_ARCH=ON -DCMAKE_BUILD_TYPE=Release
cmake --build . --config Release
cmake --install . --prefix D:\lib\openblas -v
</code></pre>
<p>また, <code>%CONDA_HOME%/Library/bin</code>をPATHに追加する必要があるかもしれない.
ここで, <code>%CONDA_HOME%</code>はAnaconda (または, miniconda) のホームディレクトリである.</p>
<p>このインストール例に従った場合は</p>
<pre><code class="language-cpp">cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_BLAS_BACKEND=ON -DBUILD_BLAS_BACKEND=ON -DBLAS_LIB_DIR=D:/lib/openblas -DBLAS_INCLUDE_DIR=D:/lib/openblas/include/openblas -DBLA_VENDOR=OpenBLAS
</code></pre>
<p>とすれば良い.</p>
<p><code>flangxxx.lib</code>関連のリンクエラーが発生する場合は, さらに<code>BLAS_DEPEND_LIB_DIR</code>オプションでAnacondaの<code>lib</code>フォルダを指定する.</p>
<pre><code class="language-cpp">cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_BLAS_BACKEND=ON -DBUILD_BLAS_BACKEND=ON -DBLAS_LIB_DIR=D:/lib/openblas -DBLAS_INCLUDE_DIR=D:/lib/openblas/include/openblas -DBLA_VENDOR=OpenBLAS -DBLAS_DEPEND_LIB_DIR=%CONDA_HOME%/Library/lib
</code></pre>
<h3 id="cuda-backend"><a class="header" href="#cuda-backend">CUDA Backend</a></h3>
<p>CUDAバックエンドをビルドする場合, <a href="https://developer.nvidia.com/cuda-toolkit">CUDA Toolkit</a>をインストールし, CMakeで<code>BUILD_CUDA_BACKEND</code>フラグをOnにすれば良い.</p>
<pre><code class="language-cpp">  cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_CUDA_BACKEND=ON
</code></pre>
<p>なお,  CUDA Toolkit version 11.4.100で動作を確認している.</p>
<h3 id="arrayfire-backend"><a class="header" href="#arrayfire-backend">ArrayFire Backend</a></h3>
<p>ArrayFireバックエンドをビルドする場合, <a href="https://arrayfire.com/">ArrayFire</a>をインストールし<sup class="footnote-reference"><a href="#fn_af">2</a></sup>, CMakeで<code>BUILD_ARRAYFIRE_BACKEND</code>フラグをOnにすれば良い.</p>
<pre><code class="language-cpp">  cmake .. -DBUILD_HOLO_GAIN=ON -DBUILD_ARRAYFIRE_BACKEND=ON
</code></pre>
<p>なお, ArrayFire version 3.8.0で動作を確認している.</p>
<h2 id="grouped"><a class="header" href="#grouped">Grouped</a></h2>
<p><code>Grouped</code>は複数のデバイスを使用する際に,
各デバイスで別々の<code>Gain</code>を使用するための<code>Gain</code>である.</p>
<p><code>Grouped</code>を使用するためには, 予め<code>add_device</code>の第3引数でデバイスをグルーピングしておく必要がある.</p>
<pre><code class="language-cpp">autd-&gt;geometry()-&gt;add_device(pos1, rot1, 0);
autd-&gt;geometry()-&gt;add_device(pos2, rot2, 0);
autd-&gt;geometry()-&gt;add_device(pos3, rot3, 1);
</code></pre>
<p>上の例だと, 1,2番目のデバイスはグループ0, 3番めのデバイスはグループ1になる.</p>
<p><code>Grouped</code>では, このグループ番号と任意の<code>Gain</code>を紐付けて使用する.</p>
<pre><code class="language-cpp">#include &quot;autd3/gain/eigen_backend.hpp&quot;
#include &quot;autd3/gain/holo.hpp&quot;

...

  const auto g0 = ...;
  const auto g1 = ...;

  const auto g = autd::gain::Grouped::create();
  g-&gt;add(0, g0);
  g-&gt;add(1, g1);
</code></pre>
<p>上の場合は, グループ0が<code>Gain g0</code>, グループ1が<code>Gain g1</code>を使用する.</p>
<h2 id="create-custom-gain-tutorial"><a class="header" href="#create-custom-gain-tutorial">Create Custom Gain Tutorial</a></h2>
<p><code>Gain</code>クラスを継承することで独自の<code>Gain</code>を作成することができる.
ここでは, <code>FocalPoint</code>と同じように単一焦点を生成する<code>Focus</code>を実際に定義してみることにする.</p>
<p><code>Gain</code>の実態は<code>vector&lt;array&lt;uint16_t, 249&gt;&gt; _data</code>であり, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>データの振動子数分の配列のデバイス数分の<code>vector</code>になっている.
<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>データの内, 上位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>がDuty比, 下位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>が位相を表す.
下が, 単一焦点を生成する<code>Gain</code>のサンプルである.</p>
<pre><code class="language-cpp">#include &quot;autd3.hpp&quot;
#include &quot;autd3/core/utils.hpp&quot;

class Focus final : public autd::core::Gain {
 public:
  Focus(autd::Vector3 point) : _point(point) {} 
  
  static autd::GainPtr create(autd::Vector3 point) { return std::make_shared&lt;Focus&gt;(point); }
  
  void calc(const autd::GeometryPtr&amp; geometry) override {
    const auto wavenum = 2.0 * M_PI / geometry-&gt;wavelength();
    for (size_t dev = 0; dev &lt; geometry-&gt;num_devices(); dev++)
      for (size_t i = 0; i &lt; autd::NUM_TRANS_IN_UNIT; i++) {
        const auto dist = (geometry-&gt;position(dev, i) - this-&gt;_point).norm();
        const auto phase = autd::core::Utilities::to_phase(dist * wavenum);
        this-&gt;_data[dev][i] = autd::core::Utilities::pack_to_u16(0xFF, phase);
      }
  }
  
  private:
    autd::Vector3 _point;
};
</code></pre>
<p><code>Controller::send</code>関数は<code>GainPtr</code>型 (<code>shared_ptr&lt;autd::core::Gain&gt;</code>のエイリアス) を引数に取る.
そのため, これを返すような<code>create</code>関数を定義しておく.
今回は, 単一焦点を生成するので, 焦点位置を引数で渡してある.</p>
<p><code>Controller::send</code>に<code>GainPtr</code>を渡すと, 内部で<code>Gain::calc</code>メソッドが呼ばれる.
そのため, この<code>calc</code>メソッド内で位相/振幅の計算を行えば良い.</p>
<p>SDKで指定した<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>のDuty比<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span><span class="mclose">]</span></span></span></span>, 及び, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>の位相<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span><span class="mclose">]</span></span></span></span>に対して, 振動子から放射される超音波音圧は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span>
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03194em;">r</span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∝</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">e</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0040200000000001em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">i</span></span></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">λ</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">π</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mtight">∥</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight" style="margin-right:0.03194em;">r</span></span></span></span><span class="mord mtight">∥</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">e</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0234649999999998em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">π</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">i</span></span></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8720928571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span><span class="mord mtight">6</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
のようにモデル化されている.
ここで, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span></span></span></span>は波長である.
また, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>はデフォルトで<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>であり, これはオプションで変更可能である.
したがって, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span></span></span></span>で音圧は最大となる<sup class="footnote-reference"><a href="#fn_duty">3</a></sup>.</p>
<p>ある点<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span></span></span></span></span>で多数の振動子からの放出された超音波の音圧が最大になるためには, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">p</span></span></span></span></span></span></span>での位相が揃えば良い.
したがって, 上の式を見れば明らかなように,
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord">−</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord">5</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">∥</span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03194em;">r</span></span></span></span><span class="mord">∥</span></span></span></span></span>
とすれば良い.
ここで, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>は振動子と焦点位置との間の距離である.</p>
<p>SDKでは, 波長は<code>Geometry::wavelength()</code>, 振動子の位置は<code>Geometry::position()</code>で取得できる.
<code>Geometry::position()</code>の第1引数はDeviceのインデックス, 第2引数はローカルな振動子のインデックスである.
また, <code>autd::core::Utilities::to_phase</code>関数は, 上記の<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">r</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span></span></span></span></span></span>単位の位相<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>をSDKの内部表現<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>に変換するためのユーティリティ関数で, 以下のように定義されている<sup class="footnote-reference"><a href="#fn_phase">4</a></sup>.</p>
<pre><code class="language-cpp">  inline static uint8_t to_phase(const double phase) noexcept {
    return static_cast&lt;uint8_t&gt;(static_cast&lt;int&gt;(std::round((phase / (2.0 * M_PI) + 0.5) * 256.0)) &amp; 0xFF);
  }
</code></pre>
<p>また, <code>autd::core::Utilities::pack_to_u16</code>はただ単に2つの<code>uint8_t</code>の値を受け取って, それぞれ<code>uint16_t</code>の値の上位/下位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>に詰めるだけのユーティリティ関数である.</p>
<div class="footnote-definition" id="fn_backend"><sup class="footnote-definition-label">1</sup>
<p>各自ソースコードからコンパイルする必要がある. GitHubにアップロードされているpre-built binaryには含まれていない.</p>
</div>
<div class="footnote-definition" id="fn_af"><sup class="footnote-definition-label">2</sup>
<p><code>%AF_PATH%/lib</code>をPATHに追加する必要があるかもしれない, ここで<code>%AF_PATH%</code>はArrayFire のインストールディレクトリである.</p>
</div>
<div class="footnote-definition" id="fn_duty"><sup class="footnote-definition-label">3</sup>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>の場合, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>でも振幅が0にならないように思われるが, お城で確認した限り振動子への入力信号は消えるので事実上問題ない.</p>
</div>
<div class="footnote-definition" id="fn_phase"><sup class="footnote-definition-label">4</sup>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">+</span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span>しているのは, <code>std::arg</code>などの返り値が<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose">]</span></span></span></span>だからである. 符号ありの<code>int</code>にしているので実際には不要だと思うが.</p>
</div>
<p>[hasegawa2017]: Hasegawa, Keisuke, et al. “Electronically steerable ultrasound-driven long narrow air stream.” Applied Physics Letters 111.6 (2017): 064104.</p>
<p>[inoue2015]: Inoue, Seki, Yasutoshi Makino, and Hiroyuki Shinoda. “Active touch perception produced by airborne ultrasonic haptic hologram.” 2015 IEEE World Haptics Conference (WHC). IEEE, 2015.</p>
<p>[long2014]: Long, Benjamin, et al. “Rendering volumetric haptic shapes in mid-air using ultrasound.” ACM Transactions on Graphics (TOG) 33.6 (2014): 1-10.</p>
<p>[marzo2019]: Marzo, Asier, and Bruce W. Drinkwater. “Holographic acoustic tweezers.” Proceedings of the National Academy of Sciences 116.1 (2019): 84-89.</p>
<p>[plasencia2020]: Plasencia, Diego Martinez, et al. “GS-PAT: high-speed multi-point sound-fields for phased arrays of transducers.” ACM Transactions on Graphics (TOG) 39.4 (2020): 138-1.</p>
<p>[levenberg1944]: Levenberg, Kenneth. “A method for the solution of certain non-linear problems in least squares.” Quarterly of applied mathematics 2.2 (1944): 164-168.</p>
<p>[marquardt1963]: Marquardt, Donald W. “An algorithm for least-squares estimation of nonlinear parameters.” Journal of the society for Industrial and Applied Mathematics 11.2 (1963): 431-441.</p>
<p>[madsen2004]: Madsen, Kaj, Hans Bruun Nielsen, and Ole Tingleff. “Methods for non-linear least squares problems.” (2004).</p>
<p>[hasegawa2020]: Hasegawa, Keisuke, Hiroyuki Shinoda, and Takaaki Nara. “Volumetric acoustic holography and its application to self-positioning by single channel measurement.” Journal of Applied Physics 127.24 (2020): 244904.</p>
<p>[suzuki2021]: Suzuki, Shun, et al. “Radiation Pressure Field Reconstruction for Ultrasound Midair Haptics by Greedy Algorithm with Brute-Force Search.” IEEE Transactions on Haptics (2021).</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="modulation"><a class="header" href="#modulation">Modulation</a></h1>
<p><code>Modulation</code>はAM変調を制御するための仕組みである.
<code>Modulation</code>は, バッファに貯められた<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">8</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>データから, 一定のサンプリングレートでデータを順番にサンプリングし, Duty比に掛け合わすことで実現されている.
現在, <code>Modulation</code>には以下の制約がある.</p>
<ul>
<li>バッファサイズは最大で65536</li>
<li>サンプリングレートは<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">6</span></span></span></span></li>
<li>Modulationは全デバイスで共通</li>
<li>Modulationは自動でループする. 1ループだけ, 等の制御は不可能.</li>
</ul>
<p>SDKにはデフォルトでいくつかの種類のAMを生成するための<code>Modulation</code>がデフォルトで用意されている.</p>
<h2 id="static"><a class="header" href="#static">Static</a></h2>
<p>変調なし.</p>
<pre><code class="language-cpp">  const auto m = autd::modulation::Static::create();
  autd-&gt;send(m);
</code></pre>
<p>なお, 第1引数は<code>uint8_t</code>の値を引数に取れ (デフォルトは255), 超音波の出力を一律で変更するために使うことができる.</p>
<h2 id="sine"><a class="header" href="#sine">Sine</a></h2>
<p>音圧をSin波状に変形するための<code>Modulation</code>.</p>
<pre><code class="language-cpp">  const auto m = autd::modulation::Sine::create(f, amplitude, offset); 
</code></pre>
<p>第1引数は周波数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>, 第2引数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span> (デフォルトで1), 第3引数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span></span></span></span> (デフォルトで0.5)になっており, 音圧の波形が
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span></span></span></span></span>
となるようなAMをかける.
ただし, 上記で<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>を超えるような値は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>に収まるように変換される.
また, サンプリング周波数はデフォルトで<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span> (<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>) になっている.</p>
<h2 id="sinepressure"><a class="header" href="#sinepressure">SinePressure</a></h2>
<p>放射圧, すなわち, 音圧の二乗をSin波状に変形するための<code>Modulation</code>.
引数等は<code>Sine</code>と同じ.</p>
<h2 id="sinelegacy"><a class="header" href="#sinelegacy">SineLegacy</a></h2>
<p>古いversionにあった<code>Sine Modulation</code>と互換.
周波数として, <code>double</code>の値を取れるが, 厳密の指定周波数になるのではなく, 出力可能な周波数の内, 最も近い周波数が選ばれる.
また, 音圧ではなくDuty比がSin波状になる.</p>
<h2 id="square"><a class="header" href="#square">Square</a></h2>
<p>矩形波状の<code>Modulation</code>.</p>
<pre><code class="language-cpp">  const auto m = autd::modulation::Square::create(f, low, high); 
</code></pre>
<p>第1引数は周波数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>, 第2引数はlow (デフォルトで0), 第3引数はhigh (デフォルトで255)になっており, 音圧の波形はlowとhighが周波数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>で繰り返される.
また, 第4引数にduty比を指定できる.
duty比は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">high</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">high</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>で定義される, ここで, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">high</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>は1周期<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>の内, highを出力する時間である.</p>
<h2 id="create-custom-modulation-tutorial"><a class="header" href="#create-custom-modulation-tutorial">Create Custom Modulation Tutorial</a></h2>
<p><code>Modulation</code>も独自の<code>Modulation</code>を作成することができる.
ここでは, 周期中のある一瞬だけ出力する<code>Burst</code>を作ってみる<sup class="footnote-reference"><a href="#fn_burst">1</a></sup>.</p>
<p>以下が, この<code>Burst</code>のサンプルである.</p>
<pre><code class="language-cpp">class Burst final : public autd::core::Modulation {
 public:
  static autd::ModulationPtr create(size_t buf_size = 4000, uint16_t N = 10) {
    return std::make_shared&lt;BurstModulation&gt;(buf_size, N);
  }
  
  void calc() override {
    this-&gt;_buffer.resize(_buf_size, 0);
    this-&gt;_buffer[_buf_size - 1] = 0xFF;
  }

  Burst(const size_t buf_size, const uint16_t N) : Modulation(N), _buf_size(buf_size) {}

 private:
  size_t _buf_size;
};
</code></pre>
<p><code>Modulation</code>も<code>Gain</code>と同じく, <code>Controller::send</code>内部で<code>Modulation::calc</code>メソッドが呼ばれる.
この<code>calc</code>の中で, <code>buffer</code>の中身を書き換えれば良い.
<code>Modulation</code>サンプリング周波数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>を決定する<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>は<code>Modulation</code>のコンストラクタの第1引数で指定する.
この例だと, デフォルトで<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>なので, サンプリング周波数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>になる.
さらに, 例えば, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord text"><span class="mord">buf_size</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span>とすると, AMは<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>が<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">9</span><span class="mord">9</span><span class="mord">9</span></span></span></span>回サンプリングされた後, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">5</span></span></span></span>が一回サンプリングされる.
したがって, 周期<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">s</span></span></span></span></span></span>の中で, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">s</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>だけ出力されるようなAMがかかる.</p>
<h2 id="modulation-common-functions"><a class="header" href="#modulation-common-functions">Modulation common functions</a></h2>
<h3 id="sampling_freq_div_ratio"><a class="header" href="#sampling_freq_div_ratio">sampling_freq_div_ratio</a></h3>
<p><code>sampling_freq_div_ratio</code>でサンプリング周波数の分周比<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>の確認, 設定する.
サンプリング周波数の基本周波数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>である.
<code>sampling_freq_div_ratio</code>は1以上65536以下の整数が指定できる.</p>
<pre><code class="language-cpp">    m-&gt;sampling_freq_div_ratio() = 5; // 40kHz/5 = 8kHz
</code></pre>
<h3 id="sampling_freq"><a class="header" href="#sampling_freq">sampling_freq</a></h3>
<p><code>sampling_freq</code>でサンプリング周波数を取得する.</p>
<div class="footnote-definition" id="fn_burst"><sup class="footnote-definition-label">1</sup>
<p>SDKにはない.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="filter"><a class="header" href="#filter">Filter</a></h1>
<p><code>Modulation</code>にデジタルフィルタを作用させるための<code>Filter</code>構造体が用意されている.</p>
<p>現在は, FPGA内部のsilent mode実装と等価なLPFのみが用意されている.</p>
<h2 id="lpf-for-silent"><a class="header" href="#lpf-for-silent">LPF for Silent</a></h2>
<pre><code class="language-cpp">#include &quot;autd3/modulation/filter/fir.hpp&quot;

...

    const auto m = autd::modulation::Sine::create(150);
    const auto lpf = autd::modulation::filter::FIR::lpf();
    lpf.apply(m);
</code></pre>
<p>上記のコードで, silent modeをOnにした時にFPGA内部で行われるのと等価なフィルタがModulationデータに作用する.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="sequence"><a class="header" href="#sequence">Sequence</a></h1>
<p>SDKでは, <code>Gain</code>を周期的に切り替えるための機能が用意されている.
これは, <code>stm</code>と<code>Sequence</code>という機能に大別される.
前者は任意の<code>Gain</code>をホスト側のメモリの許す限り使用することができるが, Softwareのタイマで実行されるため, 時間的な精度が低い.
後者はHardwareのタイマで実行されるため, 精度が高いが制約が強い.
以下ではまず前者の<code>stm</code>について述べ, 後者の<code>Sequence</code>はその次に述べる.</p>
<h2 id="stm"><a class="header" href="#stm">stm</a></h2>
<p>以下は, <code>stm</code>を用いて, 単一焦点を周期的に円周上で動かすサンプルである.</p>
<pre><code class="language-cpp">  auto autd = autd::Controller::create();
  
  ...
  
  const auto stm = autd-&gt;stm();

  const autd::Vector3 center(x, y, z);
  constexpr auto point_num = 100;
  for (auto i = 0; i &lt; point_num; i++) {
    constexpr auto radius = 20.0;
    const auto theta = 2.0 * M_PI * static_cast&lt;double&gt;(i) / point_num;
    const autd::Vector3 pos(radius * cos(theta), radius * sin(theta), 0.0);
    const auto g = autd::gain::FocalPoint::create(center + pos);
    stm-&gt;add_gain(g);
  }

  stm-&gt;start(0.5);  // 0.5 Hz

  std::cout &lt;&lt; &quot;press any key to stop...&quot; &lt;&lt; std::endl;
  std::cin.ignore();

  stm-&gt;stop();
  stm-&gt;finish();
</code></pre>
<p>上記の例だと, <code>center</code>を中心に半径<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">m</span></span></span></span></span></span>の円周上を等間隔に100点分サンプリングし, その点を一周<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>の周波数で回す.</p>
<p><code>stm</code>を使用するには, <code>Controller::stm</code>で<code>stm</code>用のコントローラを取得する.
この<code>stm</code>コントローラに<code>add_gain</code>で<code>Gain</code>を追加していく.
最後に, <code>start</code>関数で<code>stm</code>を開始する.
<code>stm</code>を一時停止する場合は<code>stop</code>関数を呼ぶ.
<code>stop</code>の後にもう一度<code>start</code>を呼べば再開される.
<code>stm</code>を終了する場合は<code>finish</code>関数を呼び出す.</p>
<p><code>stm</code>コントローラを取得してから<code>finish</code>を呼び出すまでの間は, 元の<code>Controller</code>の使用は禁止される.</p>
<h2 id="sequence-1"><a class="header" href="#sequence-1">Sequence</a></h2>
<p><code>Sequence</code>はHardwareのタイマでSpatio-Temporal Modulationを実現する.
SDKには単一焦点のみをサポートする<code>PointSequence</code>と任意の<code>Gain</code>をサポートする<code>GainSequence</code>が用意されている.</p>
<h3 id="pointsequence"><a class="header" href="#pointsequence">PointSequence</a></h3>
<p><code>PointSequence</code>には以下の制約がある.</p>
<ul>
<li>最大サンプリング点は65536</li>
<li>サンプリング周波数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">6</span></span></span></span></li>
</ul>
<p><code>PointSequence</code>の使用方法は<code>stm</code>のサンプルとほぼ同じである.</p>
<pre><code class="language-cpp">  const auto seq = autd::sequence::PointSequence::create();

  const autd::Vector3 center(x, y, z);
  constexpr auto point_num = 200;
  for (auto i = 0; i &lt; point_num; i++) {
    constexpr auto radius = 30.0;
    const auto theta = 2.0 * M_PI * static_cast&lt;double&gt;(i) / static_cast&lt;double&gt;(point_num);
    const autd::Vector3 p(radius * std::cos(theta), radius * std::sin(theta), 0);
    seq-&gt;add_point(center + p);
  }

  const auto actual_freq = seq-&gt;set_frequency(1);
  std::cout &lt;&lt; &quot;Actual frequency is &quot; &lt;&lt; actual_freq &lt;&lt; &quot; Hz\n&quot;;
  autd-&gt;send(seq);
</code></pre>
<p>サンプリング点数とサンプリング周期に関する制約によって, 指定した周波数と実際の周波数は異なる可能性がある.
例えば, 上記の例は, 200点を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>で回すため, サンプリング周波数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mord">/</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span></span></span></span>とすればよく, 制約を満たす.
しかし, <code>point_num</code>=199にすると, サンプリング周波数を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">9</span><span class="mord">9</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>にしなければならないが, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mord">9</span><span class="mord">9</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>を満たすような<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">5</span></span></span></span>は存在しない, そのため, 最も近い<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>が選択される.
これによって, 指定した周波数と実際の周波数がずれる.
<code>set_frequency</code>関数はこの実際の周波数を返してくる.</p>
<h3 id="gainsequence"><a class="header" href="#gainsequence">GainSequence</a></h3>
<p><code>GainSequence</code>は任意の<code>Gain</code>を扱えるが, 代わりに使用できる<code>Gain</code>の個数が2048個に減る.</p>
<p><code>GainSequence</code>の使用サンプルは<code>PointSequence</code>とほぼ同じである.</p>
<pre><code class="language-cpp">  const auto seq = autd::sequence::GainSequence::create();

  const autd::Vector3 center(x, y, z);
  constexpr auto point_num = 200;
  for (auto i = 0; i &lt; point_num; i++) {
    constexpr auto radius = 30.0;
    const auto theta = 2.0 * M_PI * static_cast&lt;double&gt;(i) / static_cast&lt;double&gt;(point_num);
    const autd::Vector3 p(radius * std::cos(theta), radius * std::sin(theta), 0);
    const auto g = autd::gain::FocalPoint::create(center + p);
    seq-&gt;add_gain(g);
  }

  const auto actual_freq = seq-&gt;set_frequency(1);
  std::cout &lt;&lt; &quot;Actual frequency is &quot; &lt;&lt; actual_freq &lt;&lt; &quot; Hz\n&quot;;
  autd-&gt;send(seq);
</code></pre>
<p>周波数の制約も<code>PointSequence</code>と同じである.</p>
<p><code>GainSequence</code>は位相/振幅データをすべて送信するため, レイテンシが大きい<sup class="footnote-reference"><a href="#fn_gain_seq">1</a></sup>.
これを削減するために, 位相のみを送る倍速モードと, 位相のみを<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>に圧縮して送る4倍速モードが用意されている.
これらは, <code>GainSequence::create()</code>の第1引数で切り替える.
第1引数の型は<code>GAIN_MODE</code>であり, 以下の値が用意されている.</p>
<ul>
<li><code>DUTY_PHASE_FULL</code> - 位相/振幅を送る, デフォルト</li>
<li><code>PHASE_FULL</code> - 位相のみを送る</li>
<li><code>PHASE_HALF</code> - 位相を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>に圧縮して送る</li>
</ul>
<h3 id="sequence-common-functions"><a class="header" href="#sequence-common-functions">Sequence common functions</a></h3>
<h4 id="frequency"><a class="header" href="#frequency">frequency</a></h4>
<p><code>Sequence</code>の周波数を取得する.</p>
<h4 id="period_us"><a class="header" href="#period_us">period_us</a></h4>
<p><code>Sequence</code>の周期を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>単位で取得する.</p>
<h4 id="sampling_freq-1"><a class="header" href="#sampling_freq-1">sampling_freq</a></h4>
<p><code>Sequence</code>のサンプリング周波数を取得する.</p>
<h4 id="sampling_period_us"><a class="header" href="#sampling_period_us">sampling_period_us</a></h4>
<p><code>Sequence</code>のサンプリング周期を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>単位で取得する.</p>
<h4 id="sampling_freq_div_ratio-1"><a class="header" href="#sampling_freq_div_ratio-1">sampling_freq_div_ratio</a></h4>
<p><code>Sequence</code>のサンプリング周波数の分周比を取得, 設定する.
サンプリング周波数の基本周波数は<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">4</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">k</span><span class="mord mathrm">H</span><span class="mord mathrm">z</span></span></span></span></span></span>である.
<code>sampling_freq_div_ratio</code>は1以上65536以下の整数が指定できる.</p>
<pre><code class="language-cpp">    seq-&gt;sampling_freq_div_ratio() = 5; // 40kHz/5 = 8kHz
</code></pre>
<div class="footnote-definition" id="fn_gain_seq"><sup class="footnote-definition-label">1</sup>
<p><code>PointSequence</code>のおよそ60倍のレイテンシ.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="controller"><a class="header" href="#controller">Controller</a></h1>
<p>ここでは, Controllerクラスに存在するその他の機能を紹介する.</p>
<h2 id="output-enable"><a class="header" href="#output-enable">Output enable</a></h2>
<p>出力イネーブルの設定を行う.</p>
<pre><code class="language-cpp">  autd-&gt;output_enable() = false;
</code></pre>
<p>FPGAの出力はこのフラグとの論理積になる.</p>
<p>実際にフラグが更新されるのは<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>のどれかを呼び出し後になる.</p>
<h2 id="silent-mode"><a class="header" href="#silent-mode">Silent mode</a></h2>
<p>AMやSpatio-Temporal Modulationにおいて, 位相/振幅の急激な変化が起こると, ノイズが発生する.
SDKにはこれを抑制するためのフラグが用意されている.</p>
<pre><code class="language-cpp">  autd-&gt;silent_mode() = true;
</code></pre>
<p>このフラグをOnにすると, デバイスの内部で位相/振幅データにLow-pass filterが適用され, 位相/振幅の変化がなめらかになりノイズが抑制される[suzuki2020].</p>
<p>実際にフラグが更新されるのは<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>のどれかを呼び出し後になる.</p>
<h2 id="output-balance"><a class="header" href="#output-balance">Output balance</a></h2>
<p>Hardware設計の都合により, AUTD3は振動子の出力を印加していない状態, 即ち, <code>pause</code>または<code>stop</code>を呼んだ後の状態において, 振動子には<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span></span></span></span></span></span>の電圧が印加されている.
<code>output_balance</code>フラグをOnにすると, これを基準電位に落とすことができる.</p>
<p>実際にフラグが更新されるのは<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>のどれかを呼び出し後になる.</p>
<pre><code class="language-cpp">  autd-&gt;output_balance() = true;
</code></pre>
<p>ただし, この機能はFPGAからの出力を高速にOn/Off切り替えることで実現している.
ハーフブリッジドライバへの影響は調べていないので, 使用には注意すること.
基本的に, 使わないときはそもそも電源を落としておくことをおすすめする.</p>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/no_balance.jpg"/>
  <figcaption>Without balancing</figcaption>
</figure>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/balance.jpg"/>
  <figcaption>With balancing</figcaption>
</figure>
<h2 id="check-ack"><a class="header" href="#check-ack">Check Ack</a></h2>
<p><code>check_ack</code>フラグをOnにすると, デバイスへのデータ送信時に, 送信データがきちんとデバイスで処理されたかどうかを確認するようになる.</p>
<pre><code class="language-cpp">  autd-&gt;check_ack() = true;
</code></pre>
<p><code>check_ack</code>が<code>true</code>の場合, デバイスにデータを送信する関数 (<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>) は, 送信データがきちんとデバイスで処理されたかどうかを返すようになる.</p>
<p>基本的にOffで問題ないはずだが, 確実にデータを送りたいときにはOnにする.
なお, Onにすると<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>の実行時間は増加する.</p>
<h2 id="force-fan"><a class="header" href="#force-fan">Force fan</a></h2>
<p>AUTD3デバイスには温度計が搭載されており, 温度が高くなると自動的にファンが起動する.
<code>force_fan</code>フラグはこのファンを強制的に起動するためのフラグである.
実際にフラグが更新されるのは<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>のどれかを呼び出し後になる.</p>
<pre><code class="language-cpp">  autd-&gt;force_fan() = true;
</code></pre>
<p>なお, 強制的にONにすることはできるが, 強制的にOFFにすることはできない.
ファンを使いたくない場合は, 物理的に配線を抜いておくこと.</p>
<h2 id="read-fpga-info"><a class="header" href="#read-fpga-info">Read FPGA info</a></h2>
<p><code>reads_fpga_info</code>フラグをONにすると, デバイスがFPGAの状態を返すようになる.
実際にフラグが更新されるのは<a href="Software/Users_Manual/controller.html#send-functions">Send functions</a>のどれかを呼び出し後になる.</p>
<p>FPGAの状態は<code>fpga_info</code>関数で取得できる.</p>
<pre><code class="language-cpp">  autd-&gt;reads_fpga_info() = true;
  autd-&gt;update_ctrl_flag();
  const auto fpga_info = autd-&gt;fpga_info();
</code></pre>
<p><code>fpga_info</code>の返り値は<code>uint8_t</code>のデバイス分だけの<code>vector</code>であり, 下位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>がファンの状態を表している.
それ以外のbitはすべて0である.</p>
<h2 id="duty-offset"><a class="header" href="#duty-offset">Duty offset</a></h2>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> (<a href="Software/Users_Manual/gain.html#create-custom-gain-tutorial">Create Custom Gain Tutorial</a>参照) を変更するには<code>set_duty_offset</code>関数を使う.
<code>set_duty_offset</code>の引数は<code>vector&lt;array&lt;uint8_t, 249&gt;&gt;</code>であり, 各振動子ごとに設定する.
なお, 下位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>のみが用いられる.
したがって, <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">offset</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span></span></span></span>のみ使用できる.</p>
<h2 id="output-delay"><a class="header" href="#output-delay">Output delay</a></h2>
<p>各振動子の出力を<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mord mathrm">s</span></span></span></span></span></span>単位で相対的に遅らせることができる.
これには, <code>set_output_delay</code>関数を使う.
引数は<code>vector&lt;array&lt;uint8_t, 249&gt;&gt;</code>である.
ただし, Delay値は下位<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord">7</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span></span></span></span></span></span>のみ使用され, 遅延は最大で<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mord">7</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord"><span class="mord">3</span><span class="mord">.</span><span class="mord">1</span><span class="mord">7</span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">s</span></span></span></span></span></span>である.</p>
<h2 id="pauseresumestop"><a class="header" href="#pauseresumestop">pause/resume/stop</a></h2>
<p><code>pause</code>関数を呼び出すと出力を一時停止する.
また, <code>resume</code>関数で再開する.</p>
<p><code>stop</code>関数も出力を止めるが, <code>resume</code>で再開できない.</p>
<p><code>pause</code>関数は出力を瞬間的に停止する (具体的にはFPGAからの出力に0との論理積をとる) ので, ノイズが発生することがある.
<code>stop</code>関数はそれを抑えるようになっている.</p>
<h2 id="clear"><a class="header" href="#clear">clear</a></h2>
<p>デバイス内のフラグや<code>Gain</code>/<code>Modulation</code>データ等をクリアする.</p>
<h2 id="firmware-information"><a class="header" href="#firmware-information">Firmware information</a></h2>
<p><code>firmware_info_list</code>関数でFirmwareのバージョン情報を取得できる.</p>
<pre><code class="language-cpp"> for (auto&amp;&amp; firm_info : autd-&gt;firmware_info_list()) std::cout &lt;&lt; firm_info &lt;&lt; std::endl;
</code></pre>
<h2 id="send-functions"><a class="header" href="#send-functions">Send functions</a></h2>
<p>Send functionsとは, 実際にデバイスにデータを送信する関数の総称である.
これらの関数を呼び出すことで, <code>output enable</code>, <code>silent mode</code>, <code>force fan</code>, <code>reads FPGA info</code>, <code>output balance</code>のフラグが更新される.
また, これらの関数は<code>check_ack</code>フラグによって挙動が変わる.
<code>check_ack</code>が<code>true</code>の場合, これらの関数はデバイスが実際にデータを処理するまで待機する.
特に, <code>Modulation</code>/<code>Sequence</code>を送信する際は1フレーム毎に確認が入るので, 処理時間が大きく増加する可能性がある.
また, デバイスがデータを処理したことを確認できなかった場合に<code>false</code>を返してくる.
<code>check_ack</code>が<code>false</code>の場合はデータが処理されたかどうかを確認しない, また, 返り値は常に<code>true</code>になる.</p>
<p>送信系の関数の一覧は次のとおりである.</p>
<ul>
<li><code>update_ctrl_flag</code></li>
<li><code>set_output_delay</code></li>
<li><code>set_duty_offset</code></li>
<li><code>set_delay_offset</code></li>
<li><code>clear</code><sup class="footnote-reference"><a href="#fn_clear">1</a></sup></li>
<li><code>close</code></li>
<li><code>stop</code></li>
<li><code>pause</code></li>
<li><code>resume</code></li>
<li><code>send</code></li>
</ul>
<div class="footnote-definition" id="fn_clear"><sup class="footnote-definition-label">1</sup>
<p>フラグもクリアされる</p>
</div>
<p>[suzuki2020]: Suzuki, Shun, et al. “Reducing amplitude fluctuation by gradual phase shift in midair ultrasound haptics.” IEEE transactions on haptics 13.1 (2020): 87-93.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="ffi"><a class="header" href="#ffi">FFI</a></h1>
<p>現在は, C++以外に以下の言語をサポートしている.</p>
<ul>
<li><a href="Software/FFI/./csharp.html">C#</a></li>
<li><a href="Software/FFI/./python.html">python</a></li>
<li><a href="Software/FFI/./julia.html">Julia</a></li>
<li><a href="Software/FFI/./rust.html">Rust</a></li>
</ul>
<p>また, その他の言語で使用できるC言語のAPIリファレンスは以下に書かれている.</p>
<ul>
<li><a href="Software/FFI/./reference.html">C API Reference</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="c"><a class="header" href="#c">C#</a></h1>
<p><a href="https://github.com/shinolab/autd3sharp">autd3sharp</a>は <strong>.Net Standard 2.1</strong> に対応したラッパーを提供している.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<p><a href="https://www.nuget.org/packages/autd3sharp">NuGet</a>で公開しているので, そちらからインストールすること.</p>
<h3 id="installation-for-unity"><a class="header" href="#installation-for-unity">Installation for Unity</a></h3>
<p>Unityから使う場合は, <a href="https://github.com/shinolab/autd3sharp/releases">GitHub Release</a>にてunitypackageを公開しているので, そちらを使用すること.</p>
<p>本パッケージをインストールしたあと, <code>Project Settings &gt; Player</code>から<code>Allow 'unsafe' code</code>にチェックをいれること. また警告を抑制するため, <code>Additional Compiler Arguments</code>に<code>-nullable:enable</code>を追加すること.</p>
<p><strong>なお, Unity版は座標系がz軸反転の左手系になり, 距離の単位がmになっているので注意すること.</strong></p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>基本的には, C++版と同じになるように設計している.</p>
<p>たとえば, <a href="Software/FFI/../Users_Manual/getting_started.html">Getting Started</a>と等価なコードは以下のようになる.</p>
<pre><code class="language-csharp">using AUTD3Sharp;
using AUTD3Sharp.Utils;

namespace example
{
    internal class Program
    {
        public static string GetIfname()
        {
            var adapters = AUTD.EnumerateAdapters();
            var etherCATAdapters = adapters as EtherCATAdapter[] ?? adapters.ToArray();
            foreach (var (adapter, index) in etherCATAdapters.Select((adapter, index) =&gt; (adapter, index)))
                Console.WriteLine($&quot;[{index}]: {adapter}&quot;);

            Console.Write(&quot;Choose number: &quot;);
            int i;
            while (!int.TryParse(Console.ReadLine(), out i)) { }
            return etherCATAdapters.ElementAt(i).Name;
        }

        public static void Main()
        {
            var autd = new AUTD();
            autd.AddDevice(Vector3d.Zero, Vector3d.Zero);

            var ifname = GetIfname();
            var link = Link.SOEM(ifname, autd.NumDevices);
            if (!autd.Open(link))
            {
                Console.WriteLine(AUTD.LastError);
                return;
            }

            autd.Clear();

            var firmList = autd.FirmwareInfoList().ToArray();
            foreach (var (firm, index) in firmList.Select((firm, i) =&gt; (firm, i)))
                Console.WriteLine($&quot;AUTD {index}: {firm}&quot;);

            autd.SilentMode = false;

            const double x = AUTD.TransSpacing * ((AUTD.NumTransInX - 1) / 2.0);
            const double y = AUTD.TransSpacing * ((AUTD.NumTransInY - 1) / 2.0);
            const double z = 150.0;
            var g = Gain.FocalPoint(new Vector3d(x, y, z));
            var m = Modulation.Sine(150);
            autd.Send(g, m);

            Console.ReadKey(true);

            autd.Close();
        }
    }
}
</code></pre>
<p>より詳細なサンプルは<a href="https://github.com/shinolab/autd3sharp/tree/master/example">autd3sharpのexample</a>を参照されたい.</p>
<h2 id="trouble-shooting-1"><a class="header" href="#trouble-shooting-1">Trouble shooting</a></h2>
<p>Q. linuxやmacから実行できない</p>
<p>A. 管理者権限で実行する</p>
<pre><code>sudo dotnet run
</code></pre>
<hr />
<p>Q. Ubuntu 20.04から実行できない</p>
<p>A. runtimeを指定する</p>
<pre><code>sudo dotnet run -r ubuntu-x64
</code></pre>
<hr />
<p>Q. .Net frameworkから使用できない</p>
<p>A. サポートしてないです. ソースコードを丸々コピペすれば動くかもしれません.</p>
<hr />
<p>その他, 質問があれば<a href="https://github.com/shinolab/autd3sharp/issues">GitHubのissue</a>にてお願いします.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="python"><a class="header" href="#python">python</a></h1>
<p><a href="https://github.com/shinolab/pyautd">pyautd</a>はpythonに対応したラッパーを提供している.</p>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p><a href="https://pypi.org/project/pyautd3/">PyPI</a>で公開しているので, pipからインストールすること.</p>
<pre><code>pip install pyautd3
</code></pre>
<p>あるいは, pyautdのリポジトリからインストールできる.</p>
<pre><code>pip install git+https://github.com/shinolab/pyautd.git
</code></pre>
<h3 id="linuxmacos"><a class="header" href="#linuxmacos">Linux/macOS</a></h3>
<p>Linux/macOSを使用する場合, 管理者権限が必要な場合がある. その時は, 管理者権限付きでインストールすること.</p>
<pre><code>sudo pip install pyautd3
</code></pre>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>基本的には, C++版と同じになるように設計している.</p>
<p>たとえば, <a href="Software/FFI/../Users_Manual/getting_started.html">Getting Started</a>と等価なコードは以下のようになる.</p>
<pre><code class="language-python">from pyautd3 import AUTD, Link, Gain, Modulation, TRANS_SPACING_MM, NUM_TRANS_X, NUM_TRANS_Y


def get_adapter_name():
    adapters = Link.enumerate_adapters()
    for i, adapter in enumerate(adapters):
        print('[' + str(i) + ']: ' + adapter[0] + ', ' + adapter[1])

    index = int(input('choose number: '))
    return adapters[index][0]


if __name__ == '__main__':
    autd = AUTD()

    autd.add_device([0., 0., 0.], [0., 0., 0.])

    ifname = get_adapter_name()
    link = Link.soem(ifname, autd.num_devices())
    if not autd.open(link):
        print(AUTD.last_error())
        exit()

    autd.clear()

    firm_info_list = autd.firmware_info_list()
    for i, firm in enumerate(firm_info_list):
        print(f'[{i}]: CPU: {firm[0]}, FPGA: {firm[1]}')

    autd.silent_mode = True

    x = TRANS_SPACING_MM * ((NUM_TRANS_X - 1) / 2.0)
    y = TRANS_SPACING_MM * ((NUM_TRANS_Y - 1) / 2.0)
    z = 150.0
    g = Gain.focal_point([x, y, z])
    m = Modulation.sine(150)
    autd.send(g, m)

    _ = input()

    autd.close()
</code></pre>
<p>より詳細なサンプルは<a href="https://github.com/shinolab/pyautd/tree/master/example">pyautdのexample</a>を参照されたい.</p>
<h2 id="trouble-shooting-2"><a class="header" href="#trouble-shooting-2">Trouble shooting</a></h2>
<p>Q. linuxやmacから実行できない</p>
<p>A. 管理者権限で実行する</p>
<pre><code>sudo python
</code></pre>
<p>その他, 質問があれば<a href="https://github.com/shinolab/pyautd/issues">GitHubのissue</a>にてお願いします.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="julia"><a class="header" href="#julia">Julia</a></h1>
<p><a href="https://github.com/shinolab/AUTD3.jl">AUTD3.jl</a>はJuliaに対応したラッパーを提供している.</p>
<h2 id="installation-2"><a class="header" href="#installation-2">Installation</a></h2>
<p>パッケージマネージャからインストールすること.</p>
<pre><code>(v1.6) pkg&gt; add https://github.com/shinolab/AUTD3.jl.git
</code></pre>
<h3 id="linuxmacos-1"><a class="header" href="#linuxmacos-1">Linux/macOS</a></h3>
<p>Linux/macOSを使用する場合, 管理者権限が必要な場合がある. その時は, 管理者権限付きでインストールすること.</p>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<p>基本的には, C++版と同じになるように設計している.</p>
<p>たとえば, <a href="Software/FFI/../Users_Manual/getting_started.html">Getting Started</a>と等価なコードは以下のようになる.</p>
<pre><code class="language-julia">using Printf

using AUTD3
using StaticArrays
using StaticArrays:size

function get_adapter()
    adapters = enumerate_adapters();
    for (i, adapter) in enumerate(adapters)
        @printf(&quot;[%d]: %s, %s\n&quot;, i, adapter[2], adapter[1])
    end

    print(&quot;Input number: &quot;)
    idx = tryparse(Int64, readline())
    if idx === nothing || idx &gt; length(adapters) || idx &lt; 1
        println(&quot;choose correct number!&quot;)
        return &quot;&quot;
    end

    adapters[idx][2]
end

function main()
    autd = AUTD()

    add_device(autd, SVector(0., 0., 0.), SVector(0., 0., 0.))

    adapter = get_adapter()
    link = soem_link(adapter, num_devices(autd))
    if !open_autd(autd, link)
        println(last_error())
        return
    end

    clear(autd)

    firm_info_list = firmware_info_list(autd)
    for (i, firm_info) in enumerate(firm_info_list)
        @printf(&quot;AUTD[%d]: CPU: %s, FPGA: %s\n&quot;, i, firm_info[1], firm_info[2])
    end

    set_silent_mode(autd, true)

    x = TRANS_SPACING_MM * ((NUM_TRANS_X - 1) / 2.0)
    y = TRANS_SPACING_MM * ((NUM_TRANS_Y - 1) / 2.0)
    z = 150.0
    g = focal_point_gain(SVector(x, y, z))
    freq::Int32 = 150
    m = sine_modulation(freq)

    send(autd, g, m)

    readline()

    dispose(g)
    dispose(m)
    dispose(autd)
end

main()
</code></pre>
<p>より詳細なサンプルは<a href="https://github.com/shinolab/AUTD3.jl/tree/master/example">AUTD3.jlのexample</a>を参照されたい.</p>
<h2 id="trouble-shooting-3"><a class="header" href="#trouble-shooting-3">Trouble shooting</a></h2>
<p>Q. linuxやmacから実行できない</p>
<p>A. 管理者権限で実行する</p>
<pre><code>sudo julia
</code></pre>
<p>その他, 質問があれば<a href="https://github.com/shinolab/AUTD3.jl/issues">GitHubのissue</a>にてお願いします.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="rust"><a class="header" href="#rust">Rust</a></h1>
<p><a href="https://github.com/shinolab/rust-autd">rust-autd</a>ではRust版のライブラリを提供している.</p>
<p>Rust版のライブラリはC++版をラップしたものではなく, Rustで再実装している.
そのため, 一部機能が異なる可能性がある.</p>
<h2 id="installation-3"><a class="header" href="#installation-3">Installation</a></h2>
<p><a href="https://crates.io/crates/autd3">crate.io</a>で公開しているので, <code>cargo.toml</code>にて以下のようにすれば良い.</p>
<pre><code>[dependencies]
autd3 = &quot;1.9.1&quot;
</code></pre>
<p>また, 各種Link, Gain等は別crateとして公開しているので必要に応じてdependenciesに追加すること.</p>
<pre><code>[dependencies]
autd3-soem-link = &quot;1.9.0&quot;
autd3-twincat-link = &quot;1.9.0&quot;
autd3-emulator-link = &quot;1.9.0&quot;
autd3-holo-gain = &quot;1.9.0&quot;
</code></pre>
<p>さらに, 適当な非同期ランタイムが必要になる. 以下の例ではtokioを用いる.</p>
<pre><code>[dependencies]
tokio = { version = &quot;1.6.1&quot;, features = [&quot;rt&quot;, &quot;time&quot;, &quot;rt-multi-thread&quot;]}
</code></pre>
<h2 id="usage-3"><a class="header" href="#usage-3">Usage</a></h2>
<p>基本的には, C++版と同じになるように設計している.</p>
<p>たとえば, <a href="Software/FFI/../Users_Manual/getting_started.html">Getting Started</a>と等価なコードは以下のようになる.</p>
<pre><pre class="playground"><code class="language-rust">use autd3::prelude::*;
use autd3_soem_link::{EthernetAdapters, SoemLink};
use std::io::{self, Write};

fn get_adapter() -&gt; String {
    let adapters: EthernetAdapters = Default::default();
    for (index, adapter) in adapters.into_iter().enumerate() {
        println!(&quot;[{}]: {}&quot;, index, adapter);
    }

    let i: usize;
    let mut s = String::new();
    loop {
        print!(&quot;Choose number: &quot;);
        io::stdout().flush().unwrap();

        io::stdin().read_line(&amp;mut s).unwrap();
        match s.trim().parse() {
            Ok(num) if num &lt; adapters.len() =&gt; {
                i = num;
                break;
            }
            _ =&gt; continue,
        };
    }
    let adapter = &amp;adapters[i];
    adapter.name.to_string()
}

async fn main_task() {
    let mut geometry = Geometry::new();
    geometry.add_device(Vector3::zeros(), Vector3::zeros());

    let ifname = get_adapter();
    let link = SoemLink::new(&amp;ifname, geometry.num_devices() as u16, 1, |msg| {
        eprintln!(&quot;unrecoverable error occurred: {}&quot;, msg);
        std::process::exit(-1);
    });

    let mut autd = Controller::open(geometry, link).expect(&quot;Failed to open&quot;);

    autd.clear().await.unwrap();

    println!(&quot;***** Firmware information *****&quot;);
    let firm_list = autd.firmware_infos().await.unwrap();
    for firm_info in firm_list {
        println!(&quot;{}&quot;, firm_info);
    }
    println!(&quot;********************************&quot;);

    autd.silent_mode = true;

    let center = Vector3::new(
        TRANS_SPACING_MM * ((NUM_TRANS_X - 1) as f64 / 2.0),
        TRANS_SPACING_MM * ((NUM_TRANS_Y - 1) as f64 / 2.0),
        150.0,
    );
    let mut g = Focus::new(center);
    let mut m = Sine::new(150);
    autd.send(&amp;mut g, &amp;mut m).await.unwrap();

    let mut _s = String::new();
    io::stdin().read_line(&amp;mut _s).unwrap();

    autd.close().await.unwrap();
}

fn main() {
    let rt = tokio::runtime::Runtime::new().unwrap();
    rt.block_on(async { main_task().await });
}
</code></pre></pre>
<p>より詳細なサンプルは<a href="https://github.com/shinolab/rust-autd/tree/master/autd3-examples">rust-autdのexample</a>を参照されたい.</p>
<h2 id="trouble-shooting-4"><a class="header" href="#trouble-shooting-4">Trouble shooting</a></h2>
<p>質問があれば<a href="https://github.com/shinolab/rust-autd/issues">GitHubのissue</a>にてお願いします.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h1>
<p>c言語向けのAPIは<a href="https://github.com/shinolab/autd3-library-software/tree/master/client/capi">client/capi</a>以下で定義されている.
以下に, このAPIのリファレンスを載せる. 
実際の利用方法は, <a href="https://github.com/shinolab/autd3sharp">C#</a>/<a href="https://github.com/shinolab/pyautd">python</a>/<a href="https://github.com/shinolab/AUTD3.jl">Julia</a>のラッパーライブラリを参照されたい.</p>
<blockquote>
<p>Note: なお, 呼び出し規約は特に明示していない. x86の規定はおそらくcdeclになっていると思われるが確認しておらず, x86から使用するとエラーがでるかもしれない.</p>
</blockquote>
<h2 id="autdcreatecontroller-autd3capi"><a class="header" href="#autdcreatecontroller-autd3capi">AUTDCreateController (autd3capi)</a></h2>
<p>Controllerを作成する.</p>
<p>作成した<code>Controller</code>は最後に<code>AUTDFreeController</code>で開放する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to ControllerPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdopencontroller-autd3capi"><a class="header" href="#autdopencontroller-autd3capi">AUTDOpenController (autd3capi)</a></h2>
<p>Controllerをopenする. handleは<code>AUTDCreateController</code>で作成したものを使う.
linkは各々のlinkの生成関数で作成したものを使う.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>link</td><td>void*</td><td>in</td><td>LinkPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdadddevice-autd3capi"><a class="header" href="#autdadddevice-autd3capi">AUTDAddDevice (autd3capi)</a></h2>
<p>ControllerにDeviceを追加する.
handleは<code>AUTDCreateController</code>で作成したものを使う. x, y, zは位置で, rz1, ry, rz2はZYZのオイラー角である.</p>
<p>この関数は追加されたDeviceのIdを返す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of position in millimeter</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of position in millimeter</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of position in millimeter</td></tr>
<tr><td>rz1</td><td>double</td><td>in</td><td>first angle of ZYZ euler angle in radian</td></tr>
<tr><td>ry</td><td>double</td><td>in</td><td>second angle of ZYZ euler angle in radian</td></tr>
<tr><td>rz2</td><td>double</td><td>in</td><td>third angle of ZYZ euler angle in radian</td></tr>
<tr><td>gid</td><td>int32_t</td><td>in</td><td>group Id</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>Device Id</td></tr>
</tbody></table>
<h2 id="autdadddevicequaternion-autd3capi"><a class="header" href="#autdadddevicequaternion-autd3capi">AUTDAddDeviceQuaternion (autd3capi)</a></h2>
<p>ControllerにDeviceを追加する.
handleは<code>AUTDCreateController</code>で作成したものを使う. 
x, y, zは位置で, qw, qx, qy, qzは回転を表すクオータニオンである.</p>
<p>この関数は追加されたDeviceのIdを返す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of position in millimeter</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of position in millimeter</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of position in millimeter</td></tr>
<tr><td>qw</td><td>double</td><td>in</td><td>quaternion of rotation</td></tr>
<tr><td>qx</td><td>double</td><td>in</td><td>quaternion of rotation</td></tr>
<tr><td>qy</td><td>double</td><td>in</td><td>quaternion of rotation</td></tr>
<tr><td>qz</td><td>double</td><td>in</td><td>quaternion of rotation</td></tr>
<tr><td>gid</td><td>int32_t</td><td>in</td><td>group Id</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>Device Id</td></tr>
</tbody></table>
<h2 id="autddeletedevice-autd3capi"><a class="header" href="#autddeletedevice-autd3capi">AUTDDeleteDevice (autd3capi)</a></h2>
<p>Controllerから指定されたインデックスのDeviceを削除する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>この関数は削除されたDeviceのIdを返す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>idx</td><td>int32_t</td><td>in</td><td>Device index</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>Deleted device Id</td></tr>
</tbody></table>
<h2 id="autdcleardevices-autd3capi"><a class="header" href="#autdcleardevices-autd3capi">AUTDClearDevices (autd3capi)</a></h2>
<p>Controllerから全てのDeviceを削除する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdclosecontroller-autd3capi"><a class="header" href="#autdclosecontroller-autd3capi">AUTDCloseController (autd3capi)</a></h2>
<p>ControllerをCloseする. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また, check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdclear-autd3capi"><a class="header" href="#autdclear-autd3capi">AUTDClear (autd3capi)</a></h2>
<p>デバイス内の状態をClearする.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdfreecontroller-autd3capi"><a class="header" href="#autdfreecontroller-autd3capi">AUTDFreeController (autd3capi)</a></h2>
<p>Controllerを削除する. handleは<code>AUTDCreateController</code>で作成したものを使う.
この関数以降handleは使用できない.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdisopen-autd3capi"><a class="header" href="#autdisopen-autd3capi">AUTDIsOpen (autd3capi)</a></h2>
<p>ControllerがOpenされているかどうかを返す.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if controller is open</td></tr>
</tbody></table>
<h2 id="autdgetoutputenable-autd3capi"><a class="header" href="#autdgetoutputenable-autd3capi">AUTDGetOutputEnable (autd3capi)</a></h2>
<p>Output enableフラグを返す.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>output enable flag</td></tr>
</tbody></table>
<h2 id="autdgetsilentmode-autd3capi"><a class="header" href="#autdgetsilentmode-autd3capi">AUTDGetSilentMode (autd3capi)</a></h2>
<p>silent modeフラグを返す. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>silent mode flag</td></tr>
</tbody></table>
<h2 id="autdgetforcefan-autd3capi"><a class="header" href="#autdgetforcefan-autd3capi">AUTDGetForceFan (autd3capi)</a></h2>
<p>Force fan flagを返す. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>Force fan flag</td></tr>
</tbody></table>
<h2 id="autdgetreadsfpgainfo-autd3capi"><a class="header" href="#autdgetreadsfpgainfo-autd3capi">AUTDGetReadsFPGAInfo (autd3capi)</a></h2>
<p>reads FPGA Info flagを返す.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>reads FPGA Info flag</td></tr>
</tbody></table>
<h2 id="autdgetoutputbalance-autd3capi"><a class="header" href="#autdgetoutputbalance-autd3capi">AUTDGetOutputBalance (autd3capi)</a></h2>
<p>Output balanceフラグを返す.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>Output balance flag</td></tr>
</tbody></table>
<h2 id="autdgetcheckack-autd3capi"><a class="header" href="#autdgetcheckack-autd3capi">AUTDGetCheckAck (autd3capi)</a></h2>
<p>Check ackフラグを返す. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>Check ack flag</td></tr>
</tbody></table>
<h2 id="autdsetoutputenable-autd3capi"><a class="header" href="#autdsetoutputenable-autd3capi">AUTDSetOutputEnable (autd3capi)</a></h2>
<p>Output enableを設定する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>デバイスに実際に反映されるのはsend functionsのどれかを呼び出し後である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>enable</td><td>bool</td><td>in</td><td>output enable flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetsilentmode-autd3capi"><a class="header" href="#autdsetsilentmode-autd3capi">AUTDSetSilentMode (autd3capi)</a></h2>
<p>Silent modeを設定する. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>デバイスに実際に反映されるのはsend functionsのどれかを呼び出し後である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>mode</td><td>bool</td><td>in</td><td>silent mode flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetreadsfpgainfo-autd3capi"><a class="header" href="#autdsetreadsfpgainfo-autd3capi">AUTDSetReadsFPGAInfo (autd3capi)</a></h2>
<p>FPGAの情報を読み取るかどうかを設定する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>デバイスに実際に反映されるのはsend functionsのどれか呼び出し後である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>reads_fpga_info</td><td>bool</td><td>in</td><td>read FPGA info flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetforcefan-autd3capi"><a class="header" href="#autdsetforcefan-autd3capi">AUTDSetForceFan (autd3capi)</a></h2>
<p>Force fan flagを設定する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>デバイスに実際に反映されるのはsend functionsのどれかを呼び出し後である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>force</td><td>bool</td><td>in</td><td>force fan flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetoutputbalance-autd3capi"><a class="header" href="#autdsetoutputbalance-autd3capi">AUTDSetOutputBalance (autd3capi)</a></h2>
<p>Output balance flagを設定する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>デバイスに実際に反映されるのはsend functionsのどれかを呼び出し後である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>output_balance</td><td>bool</td><td>in</td><td>Output balance flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetcheckack-autd3capi"><a class="header" href="#autdsetcheckack-autd3capi">AUTDSetCheckAck (autd3capi)</a></h2>
<p>Check ack flagを設定する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>check_ack</td><td>bool</td><td>in</td><td>Check ack flag</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgetwavelength-autd3capi"><a class="header" href="#autdgetwavelength-autd3capi">AUTDGetWavelength (autd3capi)</a></h2>
<p>波長を取得する. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>wavelength</td></tr>
</tbody></table>
<h2 id="autdgetattenuation-autd3capi"><a class="header" href="#autdgetattenuation-autd3capi">AUTDGetAttenuation (autd3capi)</a></h2>
<p>減衰係数を取得する. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>attenuation coefficient</td></tr>
</tbody></table>
<h2 id="autdsetwavelength-autd3capi"><a class="header" href="#autdsetwavelength-autd3capi">AUTDSetWavelength (autd3capi)</a></h2>
<p>波長を設定する. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>wavelength</td><td>double</td><td>in</td><td>wavelength</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetattenuation-autd3capi"><a class="header" href="#autdsetattenuation-autd3capi">AUTDSetAttenuation (autd3capi)</a></h2>
<p>減衰係数を設定する. handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>attenuation</td><td>double</td><td>in</td><td>attenuation coefficient</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgetfpgainfo-autd3capi"><a class="header" href="#autdgetfpgainfo-autd3capi">AUTDGetFPGAInfo (autd3capi)</a></h2>
<p>FPGAの情報を取得する. handleは<code>AUTDCreateController</code>で作成したものを使う.
outポインタが指す領域は, 接続しているデバイスと同じ長さである必要がある.
なお, FPGAの情報は下位1bitがFanが起動しているかどうかを表し,
他のbitは全て0である.</p>
<p>この関数を呼び出す前に<code>AUTDGetReadsFPGAInfo</code>でread FPGA info
flagをOnにしておく必要がある.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>out</td><td>uint8_t *</td><td>out</td><td>FPGA informations</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdupdatectrlflags-autd3capi"><a class="header" href="#autdupdatectrlflags-autd3capi">AUTDUpdateCtrlFlags (autd3capi)</a></h2>
<p>Control flagを更新する. send functionの一つ. output enable, silent mode, force
fan, reads FPGA info, output balance flagsを設定した後に呼び出すと,
これらの変更が実際に反映される.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsetoutputdelay-autd3capi"><a class="header" href="#autdsetoutputdelay-autd3capi">AUTDSetOutputDelay (autd3capi)</a></h2>
<p>Output delayを設定する. send functionの.
handleは<code>AUTDCreateController</code>で作成したものを使う.
delayは(Deviceの台数)<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">2</span><span class="mord">4</span><span class="mord">9</span></span></span></span>の長さのデータへのポインタである必要がある.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また, check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>delay</td><td>uint8_t *</td><td>in</td><td>pointer to delay data</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsetdutyoffset-autd3capi"><a class="header" href="#autdsetdutyoffset-autd3capi">AUTDSetDutyOffset (autd3capi)</a></h2>
<p>Duty offsetを設定する. send functionの一つ.
handleは<code>AUTDCreateController</code>で作成したものを使う.
offsetは(Deviceの台数)<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">2</span><span class="mord">4</span><span class="mord">9</span></span></span></span>の長さのデータへのポインタである必要がある.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>offset</td><td>uint8_t *</td><td>in</td><td>pointer to duty offset data</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsetdelayoffset-autd3capi"><a class="header" href="#autdsetdelayoffset-autd3capi">AUTDSetDelayOffset (autd3capi)</a></h2>
<p>Output delayとDuty offsetを設定する. send functionの一つ..
handleは<code>AUTDCreateController</code>で作成したものを使う. delay,
offsetは(Deviceの台数)<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">2</span><span class="mord">4</span><span class="mord">9</span></span></span></span>の長さのデータへのポインタである必要がある.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>delay</td><td>uint8_t *</td><td>in</td><td>pointer to output delay data</td></tr>
<tr><td>offset</td><td>uint8_t *</td><td>in</td><td>pointer to duty offset data</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdgetlasterror-autd3capi"><a class="header" href="#autdgetlasterror-autd3capi">AUTDGetLastError (autd3capi)</a></h2>
<p>最後に発生したエラーメッセージを取得する.</p>
<p>引数にはエラーメッセージへのポインタを渡す,
このポインタにエラーメッセージがコピーされる. ただし,
引数がnullptrの場合はコピーは行われない. この関数は,
null終端込みのエラーメッセージのサイズを返す.</p>
<p>エラーメッセージの長さは可変なので十分に大きな領域を確保しておくか,
または, errorにnullptrを渡し必要なサイズを取得して再び呼び出すこと.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>error</td><td>char*</td><td>out</td><td>pointer to error message</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>length of error message including null terminator</td></tr>
</tbody></table>
<h2 id="autdnumdevices-autd3capi"><a class="header" href="#autdnumdevices-autd3capi">AUTDNumDevices (autd3capi)</a></h2>
<p>接続されているDeviceの数を取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>number of devices</td></tr>
</tbody></table>
<h2 id="autdnumtransducers-autd3capi"><a class="header" href="#autdnumtransducers-autd3capi">AUTDNumTransducers (autd3capi)</a></h2>
<p>振動子の総数を取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>number of transducers</td></tr>
</tbody></table>
<h2 id="autddeviceidxfortransidx-autd3capi"><a class="header" href="#autddeviceidxfortransidx-autd3capi">AUTDDeviceIdxForTransIdx (autd3capi)</a></h2>
<p>グローバルな振動子のインデックスをDeviceのインデックスに変換する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>global_trans_idx</td><td>int32_t</td><td>in</td><td>global transducer index</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>device index</td></tr>
</tbody></table>
<h2 id="autdtranspositionbyglobal-autd3capi"><a class="header" href="#autdtranspositionbyglobal-autd3capi">AUTDTransPositionByGlobal (autd3capi)</a></h2>
<p>指定した振動子の位置を取得する.
振動子の指定はグローバルなインデックスでおこなう.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>global_trans_idx</td><td>int32_t</td><td>in</td><td>global transducer index</td></tr>
<tr><td>x</td><td>double*</td><td>out</td><td>x coordinate of transducer position</td></tr>
<tr><td>y</td><td>double*</td><td>out</td><td>y coordinate of transducer position</td></tr>
<tr><td>z</td><td>double*</td><td>out</td><td>z coordinate of transducer position</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdtranspositionbylocal-autd3capi"><a class="header" href="#autdtranspositionbylocal-autd3capi">AUTDTransPositionByLocal (autd3capi)</a></h2>
<p>指定した振動子の位置を取得する.
振動子の指定はデバイスのインデックスとローカルの振動子インデックスでおこなう.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>device_idx</td><td>int32_t</td><td>in</td><td>device index</td></tr>
<tr><td>local_trans_idx</td><td>int32_t</td><td>in</td><td>local transducer index</td></tr>
<tr><td>x</td><td>double*</td><td>out</td><td>x coordinate of transducer position</td></tr>
<tr><td>y</td><td>double*</td><td>out</td><td>y coordinate of transducer position</td></tr>
<tr><td>z</td><td>double*</td><td>out</td><td>z coordinate of transducer position</td></tr>
<tr><td>retunrn</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddevicexdirection-autd3capi"><a class="header" href="#autddevicexdirection-autd3capi">AUTDDeviceXDirection (autd3capi)</a></h2>
<p>指定したデバイスのx軸方向を取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>device_idx</td><td>int32_t</td><td>in</td><td>device index</td></tr>
<tr><td>x</td><td>double*</td><td>out</td><td>x coordinate of device x-direction</td></tr>
<tr><td>y</td><td>double*</td><td>out</td><td>y coordinate of device x-direction</td></tr>
<tr><td>z</td><td>double*</td><td>out</td><td>z coordinate of device x-direction</td></tr>
<tr><td>retunrn</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddeviceydirection-autd3capi"><a class="header" href="#autddeviceydirection-autd3capi">AUTDDeviceYDirection (autd3capi)</a></h2>
<p>指定したデバイスのy軸方向を取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>device_idx</td><td>int32_t</td><td>in</td><td>device index</td></tr>
<tr><td>x</td><td>double*</td><td>out</td><td>x coordinate of device y-direction</td></tr>
<tr><td>y</td><td>double*</td><td>out</td><td>y coordinate of device y-direction</td></tr>
<tr><td>z</td><td>double*</td><td>out</td><td>z coordinate of device y-direction</td></tr>
<tr><td>retunrn</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddevicezdirection-autd3capi"><a class="header" href="#autddevicezdirection-autd3capi">AUTDDeviceZDirection (autd3capi)</a></h2>
<p>指定したデバイスのz軸方向を取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>device_idx</td><td>int32_t</td><td>in</td><td>device index</td></tr>
<tr><td>x</td><td>double*</td><td>out</td><td>x coordinate of device z-direction</td></tr>
<tr><td>y</td><td>double*</td><td>out</td><td>y coordinate of device z-direction</td></tr>
<tr><td>z</td><td>double*</td><td>out</td><td>z coordinate of device z-direction</td></tr>
<tr><td>retunrn</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgetfirmwareinfolistpointer-autd3capi"><a class="header" href="#autdgetfirmwareinfolistpointer-autd3capi">AUTDGetFirmwareInfoListPointer (autd3capi)</a></h2>
<p>Firmware information listへのポインタを取得する.
handleは<code>AUTDCreateController</code>で作成したものを使う.
この関数で作成したlistは最後に<code>AUTDFreeFirmwareInfoListPointer</code>で開放する必要がある.</p>
<p>実際のFirmware informationは<code>AUTDGetFirmwareInfo</code>で取得する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to pointer to Firmware information list</td></tr>
</tbody></table>
<h2 id="autdgetfirmwareinfo-autd3capi"><a class="header" href="#autdgetfirmwareinfo-autd3capi">AUTDGetFirmwareInfo (autd3capi)</a></h2>
<p>Firmware informationを取得する.
<code>p_firm_info_list</code>は<code>AUTDGetFirmwareInfoListPointer</code>で作成したものを使う.</p>
<p><code>cpu_ver</code>, <code>fpga_ver</code>は長さ128のバッファを渡せば十分である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>p_firm_info_list</td><td>void*</td><td>in</td><td>pointer to Firmware information list</td></tr>
<tr><td>index</td><td>int32_t</td><td>in</td><td>Firmware information index</td></tr>
<tr><td>cpu_ver</td><td>char*</td><td>out</td><td>pointer to CPU version string</td></tr>
<tr><td>fpga_ver</td><td>char*</td><td>out</td><td>pointer to FPGA version string</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdfreefirmwareinfolistpointer-autd3capi"><a class="header" href="#autdfreefirmwareinfolistpointer-autd3capi">AUTDFreeFirmwareInfoListPointer (autd3capi)</a></h2>
<p><code>AUTDGetFirmwareInfoListPointer</code>で取得したFirmware information
listを開放する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>p_firm_info_list</td><td>void*</td><td>in</td><td>pointer to Firmware information list</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainnull-autd3capi"><a class="header" href="#autdgainnull-autd3capi">AUTDGainNull (autd3capi)</a></h2>
<p>Gain::Nullを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgaingrouped-autd3capi"><a class="header" href="#autdgaingrouped-autd3capi">AUTDGainGrouped (autd3capi)</a></h2>
<p>Gain::Groupedを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgaingroupedadd-autd3capi"><a class="header" href="#autdgaingroupedadd-autd3capi">AUTDGainGroupedAdd (autd3capi)</a></h2>
<p>Gain::GroupedにGainを追加する.
<code>grouped_gain</code>は<code>AUTDGainGrouped</code>で作成したものを使う. 
また, idには<code>AUTDAddDevice</code>, または, <code>AUTDAddDeviceQuaternion</code>で指定したGroup
Idを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>grouped_gain</td><td>void*</td><td>in</td><td>pointer to Grouped Gain</td></tr>
<tr><td>id</td><td>int32_t</td><td>in</td><td>Groupe Id</td></tr>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainfocalpoint-autd3capi"><a class="header" href="#autdgainfocalpoint-autd3capi">AUTDGainFocalPoint (autd3capi)</a></h2>
<p>Gain::FocalPointを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of focal point</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of focal point</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of focal point</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio of Gain</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainbesselbeam-autd3capi"><a class="header" href="#autdgainbesselbeam-autd3capi">AUTDGainBesselBeam (autd3capi)</a></h2>
<p>Gain::Besselを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of apex</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of apex</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of apex</td></tr>
<tr><td>n_x</td><td>double</td><td>in</td><td>x coordinate of direction</td></tr>
<tr><td>n_y</td><td>double</td><td>in</td><td>y coordinate of direction</td></tr>
<tr><td>n_z</td><td>double</td><td>in</td><td>z coordinate of direction</td></tr>
<tr><td>theta_z</td><td>double</td><td>in</td><td>angle between the side of the cone and the plane perpendicular to direction of the beam</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio of Gain</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainplanewave-autd3capi"><a class="header" href="#autdgainplanewave-autd3capi">AUTDGainPlaneWave (autd3capi)</a></h2>
<p>Gain::PlaneWaveを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>n_x</td><td>double</td><td>in</td><td>x coordinate of direction</td></tr>
<tr><td>n_y</td><td>double</td><td>in</td><td>y coordinate of direction</td></tr>
<tr><td>n_z</td><td>double</td><td>in</td><td>z coordinate of direction</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio of Gain</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgaincustom-autd3capi"><a class="header" href="#autdgaincustom-autd3capi">AUTDGainCustom (autd3capi)</a></h2>
<p>Gain::Customを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>data</td><td>uint16_t*</td><td>in</td><td>pointer to data</td></tr>
<tr><td>data_length</td><td>int32_t</td><td>in</td><td>length of data</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgaintransducertest-autd3capi"><a class="header" href="#autdgaintransducertest-autd3capi">AUTDGainTransducerTest (autd3capi)</a></h2>
<p>Gain::TransducerTestを作成する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>idx</td><td>int32_t</td><td>in</td><td>global index of transducer</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio</td></tr>
<tr><td>phase</td><td>uint8_t</td><td>in</td><td>phase</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddeletegain-autd3capi"><a class="header" href="#autddeletegain-autd3capi">AUTDDeleteGain (autd3capi)</a></h2>
<p>作成したGainを削除する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationstatic-autd3capi"><a class="header" href="#autdmodulationstatic-autd3capi">AUTDModulationStatic (autd3capi)</a></h2>
<p>Modulation::Staticを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationcustom-autd3capi"><a class="header" href="#autdmodulationcustom-autd3capi">AUTDModulationCustom (autd3capi)</a></h2>
<p>Modulation::Customを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>buf</td><td>uint8_t*</td><td>in</td><td>ModulationPtr buffer</td></tr>
<tr><td>size</td><td>uint32_t</td><td>in</td><td>length to modulation buffer</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsine-autd3capi"><a class="header" href="#autdmodulationsine-autd3capi">AUTDModulationSine (autd3capi)</a></h2>
<p>Modulation::Sineを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>freq</td><td>int32_t</td><td>in</td><td>frequency</td></tr>
<tr><td>amplitude</td><td>double</td><td>in</td><td>amplitude of sin wave</td></tr>
<tr><td>offset</td><td>double</td><td>in</td><td>offset of sin wave</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsinepressure-autd3capi"><a class="header" href="#autdmodulationsinepressure-autd3capi">AUTDModulationSinePressure (autd3capi)</a></h2>
<p>Modulation::SinePressureを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>freq</td><td>int32_t</td><td>in</td><td>frequency</td></tr>
<tr><td>amplitude</td><td>double</td><td>in</td><td>amplitude of sin wave</td></tr>
<tr><td>offset</td><td>double</td><td>in</td><td>offset of sin wave</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsinelegacy-autd3capi"><a class="header" href="#autdmodulationsinelegacy-autd3capi">AUTDModulationSineLegacy (autd3capi)</a></h2>
<p>Modulation::SineLegacyを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>freq</td><td>double</td><td>in</td><td>frequency</td></tr>
<tr><td>amplitude</td><td>double</td><td>in</td><td>amplitude of sin wave</td></tr>
<tr><td>offset</td><td>double</td><td>in</td><td>offset of sin wave</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsquare-autd3capi"><a class="header" href="#autdmodulationsquare-autd3capi">AUTDModulationSquare (autd3capi)</a></h2>
<p>Modulation::Squareを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>ModulationPtr</td></tr>
<tr><td>freq</td><td>int32_t</td><td>in</td><td>frequency</td></tr>
<tr><td>low</td><td>uint8_t</td><td>in</td><td>duty ratio at low level</td></tr>
<tr><td>high</td><td>uint8_t</td><td>in</td><td>duty ratio at high level</td></tr>
<tr><td>duty</td><td>double</td><td>in</td><td>duty ratio of the square wave, i.e., ratio of duration of high level to period</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsamplingfreqdiv-autd3capi"><a class="header" href="#autdmodulationsamplingfreqdiv-autd3capi">AUTDModulationSamplingFreqDiv (autd3capi)</a></h2>
<p>Modulationのサンプリング周波数分周比を取得する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>uint32_t</td><td>-</td><td>sampling frequency division ratio</td></tr>
</tbody></table>
<h2 id="autdmodulationsetsamplingfreqdiv-autd3capi"><a class="header" href="#autdmodulationsetsamplingfreqdiv-autd3capi">AUTDModulationSetSamplingFreqDiv (autd3capi)</a></h2>
<p>Modulationのサンプリング周波数分周比を設定する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>freq_div</td><td>uint32_t</td><td>in</td><td>sampling frequency division ratio</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationsamplingfreq-autd3capi"><a class="header" href="#autdmodulationsamplingfreq-autd3capi">AUTDModulationSamplingFreq (autd3capi)</a></h2>
<p>Modulationのサンプリング周波数を取得する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>sampling frequency</td></tr>
</tbody></table>
<h2 id="autddeletemodulation-autd3capi"><a class="header" href="#autddeletemodulation-autd3capi">AUTDDeleteModulation (autd3capi)</a></h2>
<p>Modulationを削除する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsequence-autd3capi"><a class="header" href="#autdsequence-autd3capi">AUTDSequence (autd3capi)</a></h2>
<p>PointSequenceを作成する.
作成したPointSequenceは最後に<code>AUTDDeleteSequence</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to PointSequencePtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainsequence-autd3capi"><a class="header" href="#autdgainsequence-autd3capi">AUTDGainSequence (autd3capi)</a></h2>
<p>GainSequenceを作成する.</p>
<p>作成したGainSequenceは最後に<code>AUTDDeleteSequence</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to GainSequencePtr</td></tr>
<tr><td>gain_mode</td><td>uint16_t</td><td>in</td><td>gain mode of GainSequence</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsequenceaddpoint-autd3capi"><a class="header" href="#autdsequenceaddpoint-autd3capi">AUTDSequenceAddPoint (autd3capi)</a></h2>
<p>PointSequenceに制御点を追加する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>で作成したPointSequenceを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>GainSequencePtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of point</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of point</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of point</td></tr>
<tr><td>duty</td><td>uint8_t</td><td>in</td><td>duty ratio of point</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdsequenceaddpoints-autd3capi"><a class="header" href="#autdsequenceaddpoints-autd3capi">AUTDSequenceAddPoints (autd3capi)</a></h2>
<p>PointSequenceに複数の制御点を追加する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>で作成したPointSequenceを使用する.</p>
<p><code>points</code>は<code>points_size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタであり,
x[0], y[0], z[0], x[1], y[1],
z[1],...のような順番で指定する.
<code>duties_size</code>が<code>points_size</code>未満の場合,
不足分はduty=0xFFのデータが埋められる.
<code>duties_size</code>が<code>points_size</code>より大きい場合, 過剰分は無視される.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>GainSequencePtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to points array</td></tr>
<tr><td>points_size</td><td>uint64_t</td><td>in</td><td>length of points array</td></tr>
<tr><td>duties</td><td>double*</td><td>in</td><td>pointer to duties array</td></tr>
<tr><td>duties_size</td><td>uint64_t</td><td>in</td><td>length of duties array</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdsequenceaddgain-autd3capi"><a class="header" href="#autdsequenceaddgain-autd3capi">AUTDSequenceAddGain (autd3capi)</a></h2>
<p>GainSequenceにGainを追加する.</p>
<p><code>seq</code>には<code>AUTDGainSequence</code>で作成したGainSequenceを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>GainSequencePtr</td></tr>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdsequencesetfreq-autd3capi"><a class="header" href="#autdsequencesetfreq-autd3capi">AUTDSequenceSetFreq (autd3capi)</a></h2>
<p>Sequenceに周波数を設定する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<p>この関数は実際の周波数を返す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>freq</td><td>double</td><td>in</td><td>frequency</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>actual frequency</td></tr>
</tbody></table>
<h2 id="autdsequencefreq-autd3capi"><a class="header" href="#autdsequencefreq-autd3capi">AUTDSequenceFreq (autd3capi)</a></h2>
<p>Sequenceの周波数を取得する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>actual frequency</td></tr>
</tbody></table>
<h2 id="autdsequenceperiod-autd3capi"><a class="header" href="#autdsequenceperiod-autd3capi">AUTDSequencePeriod (autd3capi)</a></h2>
<p>Sequenceのμs単位の周期を取得する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>uint32_t</td><td>-</td><td>period in μs</td></tr>
</tbody></table>
<h2 id="autdsequencesamplingperiod-autd3capi"><a class="header" href="#autdsequencesamplingperiod-autd3capi">AUTDSequenceSamplingPeriod (autd3capi)</a></h2>
<p>Sequenceのμs単位のサンプリング周期を取得する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>uint32_t</td><td>-</td><td>sampling period in μs</td></tr>
</tbody></table>
<h2 id="autdsequencesamplingfreq-autd3capi"><a class="header" href="#autdsequencesamplingfreq-autd3capi">AUTDSequenceSamplingFreq (autd3capi)</a></h2>
<p>Sequenceのサンプリング周波数を取得する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>double</td><td>-</td><td>sampling freqyency</td></tr>
</tbody></table>
<h2 id="autdsequencesamplingfreqdiv-autd3capi"><a class="header" href="#autdsequencesamplingfreqdiv-autd3capi">AUTDSequenceSamplingFreqDiv (autd3capi)</a></h2>
<p>Sequenceのサンプリング周波数分周比を取得する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>uint32_t</td><td>-</td><td>sampling freqyency division ratio</td></tr>
</tbody></table>
<h2 id="autdsequencesetsamplingfreqdiv-autd3capi"><a class="header" href="#autdsequencesetsamplingfreqdiv-autd3capi">AUTDSequenceSetSamplingFreqDiv (autd3capi)</a></h2>
<p>Sequenceのサンプリング周波数分周比を設定する.</p>
<p><code>seq</code>には<code>AUTDSequence</code>, または, <code>AUTDGainSequence</code>で作成したSequenceを使用する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>freq_div</td><td>uint32_t</td><td>in</td><td>sampling freqyency division ratio</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdcircumsequence-autd3capi"><a class="header" href="#autdcircumsequence-autd3capi">AUTDCircumSequence (autd3capi)</a></h2>
<p>円周状のPointSequenceを作成する.</p>
<p>作成したPointSequenceは最後に<code>AUTDDeleteSequence</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to PointSequencePtr</td></tr>
<tr><td>x</td><td>double</td><td>in</td><td>x coordinate of circumference</td></tr>
<tr><td>y</td><td>double</td><td>in</td><td>y coordinate of circumference</td></tr>
<tr><td>z</td><td>double</td><td>in</td><td>z coordinate of circumference</td></tr>
<tr><td>nx</td><td>double</td><td>in</td><td>x coordinate of normal of circumference</td></tr>
<tr><td>ny</td><td>double</td><td>in</td><td>y coordinate of normal of circumference</td></tr>
<tr><td>nz</td><td>double</td><td>in</td><td>z coordinate of normal of circumference</td></tr>
<tr><td>radius</td><td>double</td><td>in</td><td>radius of circumference</td></tr>
<tr><td>n</td><td>uint64_t</td><td>in</td><td>number of sampling points</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddeletesequence-autd3capi"><a class="header" href="#autddeletesequence-autd3capi">AUTDDeleteSequence (autd3capi)</a></h2>
<p>作成したSequenceを削除する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>seq</td><td>void*</td><td>in</td><td>SequencePtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdstop-autd3capi"><a class="header" href="#autdstop-autd3capi">AUTDStop (autd3capi)</a></h2>
<p>出力を停止する. send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdpause-autd3capi"><a class="header" href="#autdpause-autd3capi">AUTDPause (autd3capi)</a></h2>
<p>出力を一時停止する. send functionの一つ. 出力はAUTDResumeで再開できる.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdresume-autd3capi"><a class="header" href="#autdresume-autd3capi">AUTDResume (autd3capi)</a></h2>
<p>AUTDPauseで一時停止した出力を再開する.send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsendgain-autd3capi"><a class="header" href="#autdsendgain-autd3capi">AUTDSendGain (autd3capi)</a></h2>
<p>Gainを送信する.send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p><code>check_ack</code>がtrueの場合は,
この関数はデータが実際のデバイスで処理されるまで待機する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsendmodulation-autd3capi"><a class="header" href="#autdsendmodulation-autd3capi">AUTDSendModulation (autd3capi)</a></h2>
<p>Modulationを送信する. send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p><code>check_ack</code>がtrueの場合は,
この関数はデータが実際のデバイスで処理されるまで待機する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsendgainmodulation-autd3capi"><a class="header" href="#autdsendgainmodulation-autd3capi">AUTDSendGainModulation (autd3capi)</a></h2>
<p>GainとModulationを送信する. send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p><code>check_ack</code>がtrueの場合は,
この関数はデータが実際のデバイスで処理されるまで待機する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsendsequencemodulation-autd3capi"><a class="header" href="#autdsendsequencemodulation-autd3capi">AUTDSendSequenceModulation (autd3capi)</a></h2>
<p>PointSequenceとModulationを送信する. send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p><code>check_ack</code>がtrueの場合は,
この関数はデータが実際のデバイスで処理されるまで待機する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>seq</td><td>void*</td><td>in</td><td>PointSequencePtr</td></tr>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdsendgainsequencemodulation-autd3capi"><a class="header" href="#autdsendgainsequencemodulation-autd3capi">AUTDSendGainSequenceModulation (autd3capi)</a></h2>
<p>GainSequenceとModulationを送信する. send functionの一つ.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p><code>check_ack</code>がtrueの場合は,
この関数はデータが実際のデバイスで処理されるまで待機する.</p>
<p>この関数はエラーが発生した場合に0未満の値を返す.
エラーが生じた場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.
また,check ackフラグがOn, かつ, 返り値が0より大きい場合は,
データが実際のデバイスで処理されたことを保証する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>seq</td><td>void*</td><td>in</td><td>GainSequencePtr</td></tr>
<tr><td>mod</td><td>void*</td><td>in</td><td>ModulationPtr</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, it guarantees devices have processed data. if <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, error ocurred.</td></tr>
</tbody></table>
<h2 id="autdstmcontroller-autd3capi"><a class="header" href="#autdstmcontroller-autd3capi">AUTDSTMController (autd3capi)</a></h2>
<p>STMControllerを取得する.</p>
<p><code>handle</code>には<code>AUTDCreateController</code>で作成したControllerを使用する.</p>
<p>この関数を呼び出してから<code>AUTDFinishSTM</code>を呼び出すまでの間はhandleの使用は禁止される.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to STMControllerPtr</td></tr>
<tr><td>handle</td><td>void*</td><td>out</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdaddstmgain-autd3capi"><a class="header" href="#autdaddstmgain-autd3capi">AUTDAddSTMGain (autd3capi)</a></h2>
<p>STMControllerにGainを追加する.</p>
<p><code>handle</code>には<code>AUTDSTMController</code>で取得したControllerを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>STMControllerPtr</td></tr>
<tr><td>gain</td><td>void*</td><td>in</td><td>GainPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdstartstm-autd3capi"><a class="header" href="#autdstartstm-autd3capi">AUTDStartSTM (autd3capi)</a></h2>
<p>STMを開始する.</p>
<p><code>handle</code>には<code>AUTDSTMController</code>で取得したControllerを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>STMControllerPtr</td></tr>
<tr><td>freq</td><td>double</td><td>in</td><td>frequency</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdstopstm-autd3capi"><a class="header" href="#autdstopstm-autd3capi">AUTDStopSTM (autd3capi)</a></h2>
<p>STMを停止する.</p>
<p><code>handle</code>には<code>AUTDSTMController</code>で取得したControllerを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>STMControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdfinishstm-autd3capi"><a class="header" href="#autdfinishstm-autd3capi">AUTDFinishSTM (autd3capi)</a></h2>
<p>STMを終了する.</p>
<p><code>handle</code>には<code>AUTDSTMController</code>で取得したControllerを使用する.</p>
<p>この関数は失敗した場合にfalseを返す.
falseの場合には<code>AUTDGetLastError</code>でエラーメッセージを取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>handle</td><td>void*</td><td>in</td><td>STMControllerPtr</td></tr>
<tr><td>return</td><td>bool</td><td>-</td><td>true if success</td></tr>
</tbody></table>
<h2 id="autdeigen3backend-autd3capi-holo-gain"><a class="header" href="#autdeigen3backend-autd3capi-holo-gain">AUTDEigen3Backend (autd3capi-holo-gain)</a></h2>
<p>Eigen Backendを作成する.</p>
<p>作成したBackendは最終的に<code>AUTDDeleteBackend</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to BackendPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autddeletebackend-autd3capi-holo-gain"><a class="header" href="#autddeletebackend-autd3capi-holo-gain">AUTDDeleteBackend (autd3capi-holo-gain)</a></h2>
<p>Backendを削除する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainholosdp-autd3capi-holo-gain"><a class="header" href="#autdgainholosdp-autd3capi-holo-gain">AUTDGainHoloSDP (autd3capi-holo-gain)</a></h2>
<p>holo::SDPを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>alpha</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>repeat</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>normalize</td><td>bool</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainholoevd-autd3capi-holo-gain"><a class="header" href="#autdgainholoevd-autd3capi-holo-gain">AUTDGainHoloEVD (autd3capi-holo-gain)</a></h2>
<p>holo::EVDを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>gamma</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>normalize</td><td>bool</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainholonaive-autd3capi-holo-gain"><a class="header" href="#autdgainholonaive-autd3capi-holo-gain">AUTDGainHoloNaive (autd3capi-holo-gain)</a></h2>
<p>holo::Naiveを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhologs-autd3capi-holo-gain"><a class="header" href="#autdgainhologs-autd3capi-holo-gain">AUTDGainHoloGS (autd3capi-holo-gain)</a></h2>
<p>holo::GSを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>repeat</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhologspat-autd3capi-holo-gain"><a class="header" href="#autdgainhologspat-autd3capi-holo-gain">AUTDGainHoloGSPAT (autd3capi-holo-gain)</a></h2>
<p>holo::GSPATを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>repeat</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhololm-autd3capi-holo-gain"><a class="header" href="#autdgainhololm-autd3capi-holo-gain">AUTDGainHoloLM (autd3capi-holo-gain)</a></h2>
<p>holo::LMを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>eps_1</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>eps_2</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>tau</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>k_max</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>initial</td><td>double*</td><td>in</td><td>parameter</td></tr>
<tr><td>initial_size</td><td>int32_t</td><td>in</td><td>length of initial</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhologaussnewton-autd3capi-holo-gain"><a class="header" href="#autdgainhologaussnewton-autd3capi-holo-gain">AUTDGainHoloGaussNewton (autd3capi-holo-gain)</a></h2>
<p>holo::GaussNewtonを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>eps_1</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>eps_2</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>k_max</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>initial</td><td>double*</td><td>in</td><td>parameter</td></tr>
<tr><td>initial_size</td><td>int32_t</td><td>in</td><td>length of initial</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhologradientdescent-autd3capi-holo-gain"><a class="header" href="#autdgainhologradientdescent-autd3capi-holo-gain">AUTDGainHoloGradientDescent (autd3capi-holo-gain)</a></h2>
<p>holo::GradientDescentを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>eps</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>step</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>k_max</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>initial</td><td>double*</td><td>in</td><td>parameter</td></tr>
<tr><td>initial_size</td><td>int32_t</td><td>in</td><td>length of initial</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainholoapo-autd3capi-holo-gain"><a class="header" href="#autdgainholoapo-autd3capi-holo-gain">AUTDGainHoloAPO (autd3capi-holo-gain)</a></h2>
<p>holo::APOを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>eps</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>lambda</td><td>double</td><td>in</td><td>parameter</td></tr>
<tr><td>k_max</td><td>uint64_t</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgainhologreedy-autd3capi-holo-gain"><a class="header" href="#autdgainhologreedy-autd3capi-holo-gain">AUTDGainHoloGreedy (autd3capi-holo-gain)</a></h2>
<p>holo::Greedyを作成する.</p>
<p><code>points</code>は<code>size</code><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">×</span><span class="mord">3</span></span></span></span>の長さの配列のポインタで,
焦点の位置をx[0], y[0], z[0], x[1], ...の順番で指定する.
<code>amps</code>は<code>size</code>の長さの配列のポインタであり, 焦点の強さを指定する.</p>
<p>作成したGainは最後に<code>AUTDDeleteGain</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>gain</td><td>void**</td><td>out</td><td>pointer to GainPtr</td></tr>
<tr><td>backend</td><td>void*</td><td>in</td><td>BackendPtr</td></tr>
<tr><td>points</td><td>double*</td><td>in</td><td>pointer to foci array</td></tr>
<tr><td>amps</td><td>double*</td><td>in</td><td>pointer to amplitudes array</td></tr>
<tr><td>size</td><td>int32_t</td><td>in</td><td>number of foci</td></tr>
<tr><td>phase_div</td><td>int32_t</td><td>in</td><td>parameter</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationrawpcm-autd3capi-from-file-modulation"><a class="header" href="#autdmodulationrawpcm-autd3capi-from-file-modulation">AUTDModulationRawPCM (autd3capi-from-file-modulation)</a></h2>
<p>modulation::RawPCMを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>pointer to ModulationPtr</td></tr>
<tr><td>filename</td><td>char*</td><td>in</td><td>pointer to filename string</td></tr>
<tr><td>sampling_freq</td><td>double</td><td>in</td><td>sampling frequency of PCM</td></tr>
<tr><td>mod_sampling_freq_div</td><td>uint16_t</td><td>in</td><td>Sampling frequency division</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdmodulationwav-autd3capi-from-file-modulation"><a class="header" href="#autdmodulationwav-autd3capi-from-file-modulation">AUTDModulationWav (autd3capi-from-file-modulation)</a></h2>
<p>modulation::Wavを作成する.</p>
<p>作成したModulationは最後に<code>AUTDDeleteModulation</code>で削除する必要がある.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>mod</td><td>void**</td><td>out</td><td>pointer to ModulationPtr</td></tr>
<tr><td>filename</td><td>char*</td><td>in</td><td>pointer to filename string</td></tr>
<tr><td>mod_sampling_freq_div</td><td>uint16_t</td><td>in</td><td>Sampling frequency division</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdlinktwincat-autd3capi-twincat-link"><a class="header" href="#autdlinktwincat-autd3capi-twincat-link">AUTDLinkTwinCAT (autd3capi-twincat-link)</a></h2>
<p>link::TwinCATを作成する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to LinkPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdlinkremotetwincat-autd3capi-remote-twincat-link"><a class="header" href="#autdlinkremotetwincat-autd3capi-remote-twincat-link">AUTDLinkRemoteTwinCAT (autd3capi-remote-twincat-link)</a></h2>
<p>link::RemoteTwinCATを作成する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to LinkPtr</td></tr>
<tr><td>remote_ip_addr</td><td>char*</td><td>in</td><td>pointer to remote ip address</td></tr>
<tr><td>remote_ams_net_id</td><td>char*</td><td>in</td><td>pointer to remote ams net id</td></tr>
<tr><td>local_ams_net_id</td><td>char*</td><td>in</td><td>pointer to local ams net id</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdgetadapterpointer-autd3capi-soem-link"><a class="header" href="#autdgetadapterpointer-autd3capi-soem-link">AUTDGetAdapterPointer (autd3capi-soem-link)</a></h2>
<p>EtherCAT adapter information listへのポインタを取得する.</p>
<p>EtherCAT adapter informationの取得は<code>AUTDGetAdapter</code>で行う.</p>
<p>取得したポインタは最後に<code>AUTDFreeAdapterPointer</code>で開放する必要がある.</p>
<p>この関数は取得したlistのサイズを返す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to pointer to adapter information list</td></tr>
<tr><td>return</td><td>int32_t</td><td>-</td><td>length of EtherCAT adapter information list</td></tr>
</tbody></table>
<h2 id="autdgetadapter-autd3capi-soem-link"><a class="header" href="#autdgetadapter-autd3capi-soem-link">AUTDGetAdapter (autd3capi-soem-link)</a></h2>
<p>EtherCAT adapter informationを取得する.</p>
<p><code>p_adapter</code>は<code>AUTDGetAdapterPointer</code>で取得したポインタを渡す.</p>
<p><code>desc</code>と<code>name</code>には長さ128のバッファを渡せば十分である.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>p_adapter</td><td>void*</td><td>in</td><td>pointer to EtherCAT adapter information list</td></tr>
<tr><td>index</td><td>int32_t</td><td>in</td><td>adapter index</td></tr>
<tr><td>desc</td><td>char*</td><td>in</td><td>adapter description</td></tr>
<tr><td>name</td><td>char*</td><td>in</td><td>adapter name</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdfreeadapterpointer-autd3capi-soem-link"><a class="header" href="#autdfreeadapterpointer-autd3capi-soem-link">AUTDFreeAdapterPointer (autd3capi-soem-link)</a></h2>
<p><code>AUTDGetAdapterPointer</code>で取得したポインタを開放する.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>p_adapter</td><td>void*</td><td>in</td><td>pointer to EtherCAT adapter information list</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdlinksoem-autd3capi-soem-link"><a class="header" href="#autdlinksoem-autd3capi-soem-link">AUTDLinkSOEM (autd3capi-soem-link)</a></h2>
<p>link::SOEMを作成する.</p>
<p><code>ifname</code>にはインターフェース名を入れる. これは, <code>AUTDGetAdapter</code>で取得できる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to LinkPtr</td></tr>
<tr><td>ifname</td><td>int32_t</td><td>in</td><td>number of devices</td></tr>
<tr><td>cycle_ticks</td><td>uint32_t</td><td>in</td><td>cycle ticks</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdsetsoemonlost-autd3capi-soem-link"><a class="header" href="#autdsetsoemonlost-autd3capi-soem-link">AUTDSetSOEMOnLost (autd3capi-soem-link)</a></h2>
<p>SOEM linkにOnLostCallbackを設定する.</p>
<p>linkには<code>AUTDLinkSOEM</code>で作成したものを使う.</p>
<p>ErrorHandlerは<code>void (*)(const char*)</code>と定義されており,
エラーが発生したときにエラーメッセージを引数に呼ばれる.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>link</td><td>void*</td><td>in</td><td>SOEM LinkPtr</td></tr>
<tr><td>handler</td><td>ErrorHandler</td><td>in</td><td>error handler</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<h2 id="autdlinkemulator-autd3capi-emulator-link"><a class="header" href="#autdlinkemulator-autd3capi-emulator-link">AUTDLinkEmulator (autd3capi-emulator-link)</a></h2>
<p>link::Emulatorを作成する.</p>
<p><code>cnt</code>には<code>AUTDCreateController</code>で作成したControllerを渡す.</p>
<table><thead><tr><th>Argument name / return</th><th>type</th><th>in/out</th><th>description</th></tr></thead><tbody>
<tr><td>out</td><td>void**</td><td>out</td><td>pointer to LinkPtr</td></tr>
<tr><td>port</td><td>uint16_t</td><td>in</td><td>number of devices</td></tr>
<tr><td>cnt</td><td>void*</td><td>in</td><td>ControllerPtr</td></tr>
<tr><td>return</td><td>void</td><td>-</td><td>nothing</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="emulator-1"><a class="header" href="#emulator-1">Emulator</a></h1>
<p><a href="https://github.com/shinolab/autd-emulator">autd-emulator</a>はその名の通り, クロスプラットフォームで動作するAUTD3のエミュレータである.</p>
<h2 id="install-1"><a class="header" href="#install-1">Install</a></h2>
<p>Windows 10 64bit版のみコンパイル済みのバイナリが<a href="https://github.com/shinolab/autd-emulator/releases">GitHubで配布されている</a>のでこれをダウンロードして実行すれば良い.</p>
<p>その他の場合はRustのコンパイラをインストールして, 各自コンパイルすること.</p>
<pre><code>git clone https://github.com/shinolab/autd-emulator.git
cd autd-emulator
cargo run --release
</code></pre>
<h2 id="how-to"><a class="header" href="#how-to">How to</a></h2>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/emu-home.jpg"/>
  <figcaption>Emulator</figcaption>
</figure>
<p>autd-emulatorを実行すると上図のような画面になる.
この状態で, Emulator linkを使用したクライアントプログラムを実行すると, クライアントプログラムの内容に合わせた音場が表示される.
図の中央の黒いパネルをSliceと呼び, このSliceを使って任意の位置の音場を可視化できる.
また, 振動子の位相が色相で, 振幅が色強度で表される.</p>
<p>なお, エミュレータで表示される音場はシンプルな球面波の重ね合わせであり, 指向性や非線形効果などは考慮されない.</p>
<p>画面左に表示されるGUIでSliceやカメラの操作が行える.
なお, GUIには<a href="https://github.com/ocornut/imgui">Dear ImGui</a>を用いており, マウスによる操作のほか, “Ctrl+クリック”で数値入力モードになる.</p>
<p>また, GUI以外の場面の”ドラッグ”でカメラの移動, “Shift+ドラッグ”でカメラの回転が行える.</p>
<h3 id="slice-tab"><a class="header" href="#slice-tab">Slice tab</a></h3>
<p>SliceタブではSliceの大きさと位置, 回転を変えられる.
回転はXYZのオイラー角で指定する.
なお, “xy”, “yz”, “zx”ボタンを押すと, Sliceを各平面に平行な状態に回転させる.</p>
<p>Sliceでは音圧の強さを色で表現する.
Color scaleはこの色空間の音圧の最大値を表す.
大量のデバイスを使用すると色が飽和する場合があるので, その時はColor scaleの値を大きくすれば良い.
また, Sliceそのもののアルファ値をSlice alphaで指定できる.</p>
<p>さらに, <code>offscreen_renderer feature</code>をenableにした状態でコンパイルすると, Sliceに表示されている音場の保存及び録画ができるようになる<sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<h3 id="camera-tab"><a class="header" href="#camera-tab">Camera tab</a></h3>
<p>Sliceタブではカメラの位置, 回転, Field of Viewの角度, Near clip, Far clipの設定を変えられる.
回転はXYZのオイラー角で指定する.</p>
<h3 id="config-tab"><a class="header" href="#config-tab">Config tab</a></h3>
<p>Configタブでは波長と振動子のアルファ値, 及び, 背景色の設定ができる.</p>
<p>また, Emulator linkと接続した後は, 各デバイスごとの表示/イネーブルを切り替えられる.
表示をOffにした場合は, 表示されないだけで音場に寄与する.
イネーブルをOffにすると音場に寄与しなくなる.
さらに, デバイス毎の軸の表示もできる.</p>
<h3 id="info-tab"><a class="header" href="#info-tab">Info tab</a></h3>
<p>InfoタブではModulationやSequenceの情報が確認できる.</p>
<p>ModulationはSlice上には反映されない.
代わりに, 音圧がどのように変調されるかがこのタブで表示される.
また, rawモードではDuty比がどのように変調されるかが表示される.</p>
<p>Sequenceを送信した場合は, Sequenceの情報が表示される.
Sequenceは自動的に切り替わったりしない, 代わりにSequence idxで何番目のデータを表示するかを指定する.</p>
<p>flagの項ではControl flagが表示される.
Silent modeとForce fan以外は内部で使われるものなので無視する.
なお, Silent modeをOnにしてもSlice上の表示には変化はない.</p>
<p>また, Output delayとDuty offsetも無視される.</p>
<h3 id="log-tab"><a class="header" href="#log-tab">Log tab</a></h3>
<p>Logタブではデバッグ用のログが表示される.</p>
<h3 id="other-settings"><a class="header" href="#other-settings">Other settings</a></h3>
<p>すべての設定は<code>settings.json</code>に保存される.
幾つかの設定は<code>settings.json</code>からのみ編集できる.
この中で重要なものとして, portとvsyncがある.</p>
<p>portはSDKのEmulator linkとの間で使うポート番号である.
また, vsyncをtrueにすると垂直同期が有効になる.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Windows 10 64bit向けのコンパイル済みのバイナリではONになっている. なお, この機能は Vulkanのラッパーである<a href="https://github.com/vulkano-rs/vulkano">Vulkano</a>を使用している, コンパイルの際はVulkanoのコンパイル方法も確認すること.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="gui"><a class="header" href="#gui">GUI</a></h1>
<figure>
  <img src="https://raw.githubusercontent.com/shinolab/autd3-library-software/master/book/src/fig/Users_Manual/GUI.jpg"/>
  <figcaption>GUI controller</figcaption>
</figure>
<p>AUTDをGUIで操作して操作するためプログラムが<a href="https://github.com/shinolab/AUTD3-GUI-Controller">AUTD3 GUI Controller</a>である.
C#とWPFを使用して作られており, 現在はWindowsのみで動作する.</p>
<h2 id="install-2"><a class="header" href="#install-2">Install</a></h2>
<p>GitHubにコンパイル済みのバイナリがあるのでこれをダウンロードすれば良い.</p>
<h2 id="how-to-1"><a class="header" href="#how-to-1">How to</a></h2>
<p>AUTD3 GUI Controllerの起動後は上図のようなHome画面が表示される.
左側のタブから各種設定ができる.</p>
<h3 id="geometry-1"><a class="header" href="#geometry-1">Geometry</a></h3>
<p>GeometryタブではGeometryを定義する.
+ボタンでデバイスを追加し位置と回転を指定する.
ただし, クォータニオンによる指定はサポートしない.
また, Grouped Gainもサポートされていないので, Group IDの指定もない.
なお, ドラッグ&amp;ドロップで順番を入れ替えられる.</p>
<h3 id="link-1"><a class="header" href="#link-1">Link</a></h3>
<p>Geometryを定義した後はLinkタブでLinkを選択し, Openボタンで接続する.</p>
<h3 id="gain--modulation"><a class="header" href="#gain--modulation">Gain &amp; Modulation</a></h3>
<p>Linkを接続後はGain/ModulationタブでGain/Modulationを選択して, 右下の+ボタンでデバイスに送信する.</p>
<p>Grouped Gainはサポートされない.</p>
<h3 id="sequence-2"><a class="header" href="#sequence-2">Sequence</a></h3>
<p>Gain Sequenceはサポートされておらず, PointSequenceのみ使用可能になっている.</p>
<h3 id="others"><a class="header" href="#others">Others</a></h3>
<p>画面上部のファイルボタンで現在の設定を保存する.
その右のフォルダボタンで保存した設定を呼び出せる.
また, その右の緑色の三角のボタンでresume, その右の赤いポーズボタンでpauseができる.</p>
<p>終了するには右上のボタンを押す.
なお, 終了時に現在の設定が自動保存され, 次回起動時に復元される.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="citation"><a class="header" href="#citation">Citation</a></h1>
<p>If you use this SDK in your research please consider to include the following citation in your publications:</p>
<ul>
<li><a href="https://ieeexplore.ieee.org/document/9392322">S. Suzuki, S. Inoue, M. Fujiwara, Y. Makino and H. Shinoda, “AUTD3: Scalable Airborne Ultrasound Tactile Display,” in IEEE Transactions on Haptics, doi: 10.1109/TOH.2021.3069976.</a></li>
<li>S. Inoue, Y. Makino and H. Shinoda “Scalable Architecture for Airborne Ultrasound Tactile Display”, Asia Haptics 2016</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
    </body>
</html>
